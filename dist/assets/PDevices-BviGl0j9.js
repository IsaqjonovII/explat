import{_ as e}from"./qr-code-DgjEc1tF.js";import{u as t,_ as a}from"./FilterDateRange.vue_vue_type_script_setup_true_lang-eWI-paCh.js";import{p as s,d as l,x as i,c as d,k as r,J as n,a as c,o,w as u,u as v,g as m,b as p,t as y,i as g,n as x,e as b,E as f,f as _,M as h,N as k,O as w,P as $,Q as j,R as D,S as V,y as S,A as C}from"./index-WxT9CGhK.js";import{_ as q}from"./BaseButton.vue_vue_type_script_setup_true_lang-2OYisnk0.js";import{_ as U}from"./BaseModal.vue_vue_type_script_setup_true_lang-CRKxBwXe.js";import{B as F,_ as M}from"./FormFilterLabel.vue_vue_type_script_setup_true_lang-BW394oxl.js";import"./FormInput-BWmykW5Y.js";function A(e){return s(e).format("DD.MM.YYYY, HH:mm")}const B={key:0,class:"space-y-6"},P={class:"flex items-center justify-between p-4 bg-gray-5 rounded-lg"},I={class:"flex items-center gap-3"},L={class:"text-lg font-semibold text-dark"},N={class:"text-sm text-gray-1"},z={class:"text-right"},E={class:"text-xs text-gray-1 mt-1"},T={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Y={class:"space-y-4"},R={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},H={class:"space-y-3"},O={class:"flex justify-between items-center"},J={class:"text-sm text-gray-1"},K={class:"flex items-center gap-2"},Q={class:"text-sm font-mono text-dark"},G={class:"flex justify-between items-center"},W={class:"text-sm text-gray-1"},X={class:"text-sm text-dark"},Z={class:"flex justify-between items-center"},ee={class:"text-sm text-gray-1"},te={class:"text-sm text-dark"},ae={class:"flex justify-between items-center"},se={class:"text-sm text-gray-1"},le={class:"text-sm text-dark"},ie={class:"space-y-4"},de={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},re={class:"space-y-3"},ne={class:"flex justify-between items-center"},ce={class:"text-sm text-gray-1"},oe={class:"flex items-center gap-2"},ue={class:"w-16 bg-gray-4 rounded-full h-2"},ve={class:"text-sm font-medium text-dark"},me={class:"flex justify-between items-center"},pe={class:"text-sm text-gray-1"},ye={class:"flex justify-between items-center"},ge={class:"text-sm text-gray-1"},xe={class:"text-sm text-dark"},be={class:"space-y-4"},fe={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},_e={class:"grid grid-cols-2 gap-4"},he={class:"flex justify-between items-center"},ke={class:"text-sm text-gray-1"},we={class:"text-sm font-mono text-dark"},$e={class:"flex justify-between items-center"},je={class:"text-sm text-gray-1"},De={class:"text-sm font-mono text-dark"},Ve={class:"space-y-4"},Se={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qe={class:"flex justify-between items-center"},Ue={class:"text-sm text-gray-1"},Fe={class:"text-sm text-dark"},Me={class:"flex justify-between items-center"},Ae={class:"text-sm text-gray-1"},Be={class:"text-sm text-dark"},Pe={key:1,class:"flex items-center justify-center py-8"},Ie={class:"flex justify-end gap-3"},Le=_(l({__name:"DeviceDetailsModal",props:{modelValue:{type:Boolean},deviceUid:{}},emits:["update:modelValue","device-loaded"],setup(e,{emit:t}){const a=e,s=t,{t:l}=i(),{showToast:_}=f(),h=d({get:()=>a.modelValue,set:e=>s("update:modelValue",e)}),k=r(null),w=r(!1),$=async()=>{if(a.deviceUid)try{w.value=!0;const e=await fetch(`/explat/devices/${a.deviceUid}/`);if(!e.ok)throw new Error("Failed to fetch device details");const t=await e.json();k.value=t,s("device-loaded",t)}catch(e){console.error("Error loading device details:",e),_("error",l("devices.error_loading_details"))}finally{w.value=!1}},j=()=>{$()},D=()=>{h.value=!1,k.value=null},V=e=>{switch(e){case"active":return"bg-green/10 text-green";case"inactive":default:return"bg-gray-4 text-gray-8";case"maintenance":return"bg-yellow/10 text-yellow";case"offline":return"bg-red/10 text-red"}};return n(()=>a.modelValue,e=>{e&&a.deviceUid&&$()}),(e,t)=>(o(),c(v(U),{title:e.$t("devices.details"),modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=e=>h.value=e),onClose:D,class:"max-w-2xl"},{footer:u(()=>[p("div",Ie,[b(v(q),{text:e.$t("button.close"),variant:"outline",onClick:D},null,8,["text"]),b(v(q),{text:e.$t("devices.refresh"),onClick:j,loading:w.value},null,8,["text","loading"])])]),default:u(()=>{return[k.value?(o(),m("div",B,[p("div",P,[p("div",I,[t[2]||(t[2]=p("div",{class:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center"},[p("i",{class:"icon-phone text-white text-xl"})],-1)),p("div",null,[p("h3",L,y(k.value.name),1),p("p",N,y(k.value.model),1)])]),p("div",z,[p("span",{class:g([V(k.value.status),"px-3 py-1 rounded-full text-xs font-medium"])},y(e.$t(`devices.status.${k.value.status}`)),3),p("p",E,"ID: "+y(k.value.id),1)])]),p("div",T,[p("div",Y,[p("h4",R,y(e.$t("devices.basic_info")),1),p("div",H,[p("div",O,[p("span",J,y(e.$t("devices.uid"))+":",1),p("div",K,[p("span",Q,y(k.value.uid),1),p("i",{class:"icon-copy text-primary cursor-pointer hover:text-blue transition-300",onClick:t[0]||(t[0]=e=>(async e=>{try{await navigator.clipboard.writeText(e),_("success",l("common.copied"))}catch(t){console.error("Failed to copy:",t),_("error",l("common.copy_failed"))}})(k.value.uid))})])]),p("div",G,[p("span",W,y(e.$t("devices.phone_number"))+":",1),p("span",X,y(k.value.phone_number),1)]),p("div",Z,[p("span",ee,y(e.$t("devices.carrier"))+":",1),p("span",te,y(k.value.carrier),1)]),p("div",ae,[p("span",se,y(e.$t("devices.user_id"))+":",1),p("span",le,y(k.value.user_id),1)])])]),p("div",ie,[p("h4",de,y(e.$t("devices.status_performance")),1),p("div",re,[p("div",ne,[p("span",ce,y(e.$t("devices.battery"))+":",1),p("div",oe,[p("div",ue,[p("div",{class:g(["h-2 rounded-full transition-all duration-300",(a=k.value.battery,a>50?"bg-green":a>20?"bg-yellow":"bg-red")]),style:x({width:`${k.value.battery}%`})},null,6)]),p("span",ve,y(k.value.battery)+"%",1)])]),p("div",me,[p("span",pe,y(e.$t("devices.availability"))+":",1),p("span",{class:g([k.value.is_available?"text-green":"text-red","text-sm font-medium"])},y(k.value.is_available?e.$t("devices.available"):e.$t("devices.unavailable")),3)]),p("div",ye,[p("span",ge,y(e.$t("devices.last_healthcheck"))+":",1),p("span",xe,y(v(A)(k.value.healthcheck_at)),1)])])])]),p("div",be,[p("h4",fe,y(e.$t("devices.location")),1),p("div",_e,[p("div",he,[p("span",ke,y(e.$t("devices.latitude"))+":",1),p("span",we,y(k.value.latitude),1)]),p("div",$e,[p("span",je,y(e.$t("devices.longitude"))+":",1),p("span",De,y(k.value.longitude),1)])])]),p("div",Ve,[p("h4",Se,y(e.$t("devices.timestamps")),1),p("div",Ce,[p("div",qe,[p("span",Ue,y(e.$t("devices.created_at"))+":",1),p("span",Fe,y(v(A)(k.value.created_at)),1)]),p("div",Me,[p("span",Ae,y(e.$t("devices.updated_at"))+":",1),p("span",Be,y(v(A)(k.value.updated_at)),1)])])])])):(o(),m("div",Pe,[...t[3]||(t[3]=[p("div",{class:"loader"},null,-1)])]))];var a}),_:1},8,["title","modelValue"]))}}),[["__scopeId","data-v-075d4197"]]),Ne=()=>{const{t:e}=i();return[{id:1,name:e("statuses.all_statuses"),key:"all"},{id:2,name:e("devices.status.active"),key:"active"},{id:3,name:e("devices.status.inactive"),key:"inactive"}]},ze=()=>{const{t:e}=i();return[{title:"â„–",key:"_index"},{title:"ID",key:"id",hasSort:!0},{title:e("devices.name"),key:"name",hasSort:!0},{title:e("devices.model"),key:"model",hasSort:!0},{title:e("devices.phone_number"),key:"phone_number",hasSort:!0},{title:e("devices.battery"),key:"battery",hasSort:!0},{title:e("devices.carrier"),key:"carrier",hasSort:!0},{title:e("devices.status"),key:"status",hasSort:!0},{title:e("devices.availability"),key:"is_available",hasSort:!0}]},Ee=()=>{const{t:e}=i();return{noData:{title:e("transactions_not_found"),subtitle:e("transactions_not_found_try_again_later"),image:"/images/no-data/transactions.png"},thClass:"last:!text-left"}},Te=()=>{const{t:e}=i();return[{id:1,name:e("all"),key:"all"},{id:2,name:"Beeline",key:"beeline"},{id:3,name:"Ucell",key:"ucell"},{id:4,name:"UzMobile",key:"uzmobile"},{id:5,name:"Mobiuz",key:"mobiuz"}]},Ye=()=>{const{t:e}=i();return[{id:1,name:e("devices.ordering.id_asc"),key:"id"},{id:2,name:e("devices.ordering.id_desc"),key:"-id"},{id:3,name:e("devices.ordering.name_asc"),key:"name"},{id:4,name:e("devices.ordering.name_desc"),key:"-name"},{id:5,name:e("devices.ordering.battery_asc"),key:"battery"},{id:6,name:e("devices.ordering.battery_desc"),key:"-battery"},{id:7,name:e("devices.ordering.created_asc"),key:"created_at"},{id:8,name:e("devices.ordering.created_desc"),key:"-created_at"}]},Re=(e,a={},s=["tab"],l=!1,i=10)=>{const r=k(),c=D(),o=t("search",""),u=a.limit??10,v=h({total:0,limit:t("limit",u,{transform:Number}),page:t("page",1,{transform:Number}),offset:0}),m=d(()=>(v.page-1)*v.limit),p=d(()=>{const e={...a,limit:v.limit,offset:m.value};return Object.keys(r.query).forEach(t=>{s.includes(t)||(e[t]=r.query[t])}),e}),y=d(()=>["tableData",e,{...p.value,page:v.page,limit:v.limit}]),{data:g,error:x,refetch:b,isLoading:f}=w({queryKey:y,queryFn:()=>(async(e,t)=>await V.$get(e,t))(e,{params:p.value}),enabled:!0});n([f,x,g],()=>{f.value||x.value||!g.value||(v.total=g.value.count||0)}),$(()=>{g.value&&g.value.count&&(v.total=g.value.count)});$(()=>{const e=r.query,t=e.limit?Number(e.limit):u,a=Number(e.page)||1,s=e.search||"";s!==o.value?(v.limit=i,v.page=1,o.value=Array.isArray(s)?s[0]:s):(v.limit=t,v.page=a)});j(()=>{window.scrollTo({top:0,behavior:"smooth"})});return{tableData:d(()=>g.value?l?g.value:g.value.results:[]),pagination:v,isLoading:f,error:x,onPageChange:e=>{e&&e!==v.page&&(v.page=e,c.push({query:{...r.query,page:e.toString()}}))},refetch:b}},He={class:"bg-white px-6 rounded-xl"},Oe={class:"flex items-center gap-1"},Je={class:"text-sm font-medium text-dark-black"},Ke={class:"flex gap-5 flex-wrap"},Qe=_(l({__name:"PDevices",setup(s){const{t:l}=i(),d=t("status",l("statuses.all_statuses")),{tableData:n,pagination:c,isLoading:x,onPageChange:f}=Re("/explat/devices/",(()=>{const e={};return d.value&&d.value!==l("statuses.all_statuses")&&(e.status=d.value),e})(),["tab"]),_=r(!1),h=()=>{_.value=!0},k=r(!1),w=r("");function $(e){w.value=e.uid,k.value=!0}function j(e){console.log("Device loaded:",e)}const D=e=>{switch(e){case"active":return"success_status";case"inactive":return"canceled_status";case"maintenance":return"pending_status";case"offline":return"failed_status";default:return""}};return(t,s)=>(o(),m("section",null,[p("div",He,[b(v(F),S({data:v(n),head:v(ze)(),"has-add-button":{title:t.$t("devices.add")},onAdd:h,loading:v(x),title:t.$t("devices.title"),subtitle:t.$t("devices.count",{count:v(c).total}),total:v(c).total,filter:{status:v(Ne)(),carrier:v(Te)(),ordering:v(Ye)()}},v(Ee)(),{onClickToRow:$,onPageChange:v(f)}),{id:u(({data:e})=>[p("div",Oe,[p("span",Je,[C(y(null==e?void 0:e.id)+" ",1),s[2]||(s[2]=p("i",{class:"icon-copy text-primary font-semibold"},null,-1))])])]),name:u(({data:e})=>[C(y(null==e?void 0:e.name),1)]),model:u(({data:e})=>[C(y(null==e?void 0:e.model),1)]),phone_number:u(({data:e})=>[C(y(null==e?void 0:e.phone_number),1)]),battery:u(({data:e})=>[C(y(null==e?void 0:e.battery)+"% ",1)]),carrier:u(({data:e})=>[C(y(null==e?void 0:e.carrier),1)]),status:u(({data:e})=>[p("span",{class:g(D(null==e?void 0:e.status))},y(t.$t(`devices.status.${null==e?void 0:e.status}`)),3)]),is_available:u(({data:e})=>[p("span",{class:g((null==e?void 0:e.is_available)?"text-green-600":"text-red-600")},y((null==e?void 0:e.is_available)?t.$t("devices.available"):t.$t("devices.unavailable")),3)]),filter:u(()=>[p("div",Ke,[b(M,{label:t.$t("interval_of_time")},{default:u(()=>[b(a,{class:"bg-white","start-date-key":"created_at__gte","end-date-key":"created_at__lte"})]),_:1},8,["label"])])]),_:1},16,["data","head","has-add-button","loading","title","subtitle","total","filter","onPageChange"]),b(v(U),{title:t.$t("devices.add"),modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=e=>_.value=e)},{default:u(()=>[s[3]||(s[3]=p("figure",{class:"bg-primary p-5"},[p("img",{src:e,alt:"qr"})],-1)),s[4]||(s[4]=p("p",{class:"text-center"},"ASdle19uh2aAD2d23dasd424f8eisdkh244wie",-1)),b(v(q),{text:t.$t("copy")},null,8,["text"])]),_:1},8,["title","modelValue"])]),b(Le,{modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=e=>k.value=e),"device-uid":w.value,onDeviceLoaded:j},null,8,["modelValue","device-uid"])]))}}),[["__scopeId","data-v-935ddf73"]]);export{Qe as default};
