import{u as e,_ as t}from"./FilterDateRange.vue_vue_type_script_setup_true_lang-zYLrnFB7.js";import{I as a,d as s,x as l,c as i,k as d,y as c,a as r,o as n,w as o,u,g as v,b as m,t as p,i as x,n as y,e as _,z as b,f as g,G as f,A as h,C as k}from"./index-pTZ7e48Z.js";import{_ as $}from"./BaseButton.vue_vue_type_script_setup_true_lang-riteCsVf.js";import{a as w,B as V,_ as j}from"./FormFilterLabel.vue_vue_type_script_setup_true_lang-CtwkSkIZ.js";import{_ as C}from"./BaseModal.vue_vue_type_script_setup_true_lang-BeCUACXu.js";import{f as D}from"./common-DgFtQOvP.js";import{u as U,r as S,_ as z}from"./useForm-B8tYdfpU.js";import{F}from"./FormInput-CSKp9Vlr.js";import{u as B}from"./useTableFetch-DZtLCLei.js";const I=async e=>a.$get(`/explat/devices/${e}/`),T=async e=>a.$post("/explat/devices/",e),E=async(e,t)=>a.$patch(`/explat/devices/${e}/`,t),M=async e=>a.$delete(`/explat/devices/${e}/`),A=async e=>a.$post(`/explat/devices/${e}/healthcheck/`),P={key:0,class:"space-y-6"},q={class:"flex items-center justify-between p-4 bg-gray-5 rounded-lg"},L={class:"flex items-center gap-3"},R={class:"text-lg font-semibold text-dark"},G={class:"text-sm text-gray-1"},H={class:"text-right"},J={class:"text-xs text-gray-1 mt-1"},K={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},N={class:"space-y-4"},O={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},Q={class:"space-y-3"},W={class:"flex justify-between items-center"},X={class:"text-sm text-gray-1"},Y={class:"flex items-center gap-2"},Z={class:"text-sm font-mono text-dark"},ee={class:"flex justify-between items-center"},te={class:"text-sm text-gray-1"},ae={class:"text-sm text-dark"},se={class:"flex justify-between items-center"},le={class:"text-sm text-gray-1"},ie={class:"text-sm text-dark"},de={class:"flex justify-between items-center"},ce={class:"text-sm text-gray-1"},re={class:"text-sm text-dark"},ne={class:"space-y-4"},oe={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},ue={class:"space-y-3"},ve={class:"flex justify-between items-center"},me={class:"text-sm text-gray-1"},pe={class:"flex items-center gap-2"},xe={class:"w-16 bg-gray-4 rounded-full h-2"},ye={class:"text-sm font-medium text-dark"},_e={class:"flex justify-between items-center"},be={class:"text-sm text-gray-1"},ge={class:"flex justify-between items-center"},fe={class:"text-sm text-gray-1"},he={class:"text-sm text-dark"},ke={class:"space-y-4"},$e={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},we={class:"grid grid-cols-2 gap-4"},Ve={class:"flex justify-between items-center"},je={class:"text-sm text-gray-1"},Ce={class:"text-sm font-mono text-dark"},De={class:"flex justify-between items-center"},Ue={class:"text-sm text-gray-1"},Se={class:"text-sm font-mono text-dark"},ze={class:"space-y-4"},Fe={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ie={class:"flex justify-between items-center"},Te={class:"text-sm text-gray-1"},Ee={class:"text-sm text-dark"},Me={class:"flex justify-between items-center"},Ae={class:"text-sm text-gray-1"},Pe={class:"text-sm text-dark"},qe={key:1,class:"flex items-center justify-center py-8"},Le={class:"flex justify-end gap-3"},Re=g(s({__name:"DeviceDetailsModal",props:{modelValue:{type:Boolean},deviceUid:{}},emits:["update:modelValue","device-loaded"],setup(e,{emit:t}){const a=e,s=t,{t:g}=l(),{showToast:f}=b(),h=i({get:()=>a.modelValue,set:e=>s("update:modelValue",e)}),k=d(null),w=d(!1),V=async()=>{if(a.deviceUid)try{w.value=!0;const e=await I(a.deviceUid);k.value=e,s("device-loaded",e)}catch(e){console.error("Error loading device details:",e),f("error",g("devices.error_loading_details"))}finally{w.value=!1}},j=()=>{V()},U=()=>{h.value=!1,k.value=null},S=e=>{switch(e){case"active":return"bg-green/10 text-green";case"inactive":default:return"bg-gray-4 text-gray-8";case"maintenance":return"bg-yellow/10 text-yellow";case"offline":return"bg-red/10 text-red"}};return c(()=>a.modelValue,e=>{e&&a.deviceUid&&V()}),(e,t)=>(n(),r(u(C),{title:e.$t("devices.details"),modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=e=>h.value=e),onClose:U,class:"max-w-2xl"},{footer:o(()=>[m("div",Le,[_(u($),{text:e.$t("button.close"),variant:"outline",onClick:U},null,8,["text"]),_(u($),{text:e.$t("devices.refresh"),onClick:j,loading:w.value},null,8,["text","loading"])])]),default:o(()=>{return[k.value?(n(),v("div",P,[m("div",q,[m("div",L,[t[2]||(t[2]=m("div",{class:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center"},[m("i",{class:"icon-phone text-white text-xl"})],-1)),m("div",null,[m("h3",R,p(k.value.name),1),m("p",G,p(k.value.model),1)])]),m("div",H,[m("span",{class:x([S(k.value.status),"px-3 py-1 rounded-full text-xs font-medium"])},p(e.$t(`devices.status.${k.value.status}`)),3),m("p",J,"ID: "+p(k.value.id),1)])]),m("div",K,[m("div",N,[m("h4",O,p(e.$t("devices.basic_info")),1),m("div",Q,[m("div",W,[m("span",X,p(e.$t("devices.uid"))+":",1),m("div",Y,[m("span",Z,p(k.value.uid),1),m("i",{class:"icon-copy text-primary cursor-pointer hover:text-blue transition-300",onClick:t[0]||(t[0]=e=>(async e=>{try{await navigator.clipboard.writeText(e),f("success",g("common.copied"))}catch(t){console.error("Failed to copy:",t),f("error",g("common.copy_failed"))}})(k.value.uid))})])]),m("div",ee,[m("span",te,p(e.$t("devices.phone_number"))+":",1),m("span",ae,p(k.value.phone_number),1)]),m("div",se,[m("span",le,p(e.$t("devices.carrier"))+":",1),m("span",ie,p(k.value.carrier),1)]),m("div",de,[m("span",ce,p(e.$t("devices.user_id"))+":",1),m("span",re,p(k.value.user_id),1)])])]),m("div",ne,[m("h4",oe,p(e.$t("devices.status_performance")),1),m("div",ue,[m("div",ve,[m("span",me,p(e.$t("devices.battery"))+":",1),m("div",pe,[m("div",xe,[m("div",{class:x(["h-2 rounded-full transition-all duration-300",(a=k.value.battery,a>50?"bg-green":a>20?"bg-yellow":"bg-red")]),style:y({width:`${k.value.battery}%`})},null,6)]),m("span",ye,p(k.value.battery)+"%",1)])]),m("div",_e,[m("span",be,p(e.$t("devices.availability"))+":",1),m("span",{class:x([k.value.is_available?"text-green":"text-red","text-sm font-medium"])},p(k.value.is_available?e.$t("devices.available"):e.$t("devices.unavailable")),3)]),m("div",ge,[m("span",fe,p(e.$t("devices.last_healthcheck"))+":",1),m("span",he,p(u(D)(k.value.healthcheck_at)),1)])])])]),m("div",ke,[m("h4",$e,p(e.$t("devices.location")),1),m("div",we,[m("div",Ve,[m("span",je,p(e.$t("devices.latitude"))+":",1),m("span",Ce,p(k.value.latitude),1)]),m("div",De,[m("span",Ue,p(e.$t("devices.longitude"))+":",1),m("span",Se,p(k.value.longitude),1)])])]),m("div",ze,[m("h4",Fe,p(e.$t("devices.timestamps")),1),m("div",Be,[m("div",Ie,[m("span",Te,p(e.$t("devices.created_at"))+":",1),m("span",Ee,p(u(D)(k.value.created_at)),1)]),m("div",Me,[m("span",Ae,p(e.$t("devices.updated_at"))+":",1),m("span",Pe,p(u(D)(k.value.updated_at)),1)])])])])):(n(),v("div",qe,[...t[3]||(t[3]=[m("div",{class:"loader"},null,-1)])]))];var a}),_:1},8,["title","modelValue"]))}}),[["__scopeId","data-v-2531da7b"]]),Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},He={class:"flex gap-3 mt-6"},Je=s({__name:"AddDeviceModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","device-created"],setup(e,{emit:t}){const a=e,s=t,{t:c}=l(),{showToast:v}=b(),p=i({get:()=>a.modelValue,set:e=>s("update:modelValue",e)}),x=d(!1),y=U({name:"",phone_number:"",status:"active"},{name:{required:S},phone_number:{required:S},status:{required:S}}),g=[{label:c("devices.status.active"),value:"active"},{label:c("devices.status.inactive"),value:"inactive"}],h=async()=>{if(y.$v.value.$touch(),!y.$v.value.$invalid)try{x.value=!0;const e={name:y.values.name,phone_number:y.values.phone_number,status:y.values.status},t=await T(e);v("success",c("devices.device_created_successfully")),s("device-created",t),k()}catch(e){console.error("Error creating device:",e),v("error",c("devices.error_creating_device"))}finally{x.value=!1}},k=()=>{y.values.name="",y.values.phone_number="",y.values.status="active",y.$v.value.$reset(),p.value=!1};return(e,t)=>(n(),r(u(C),{title:e.$t("devices.add"),modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=e=>p.value=e),onClose:k,class:"max-w-2xl"},{default:o(()=>[m("form",{onSubmit:f(h,["prevent"])},[m("div",Ge,[_(u(z),{label:e.$t("devices.name")},{default:o(()=>[_(u(F),{modelValue:u(y).values.name,"onUpdate:modelValue":t[0]||(t[0]=e=>u(y).values.name=e),placeholder:e.$t("devices.name"),error:u(y).$v.value.name.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),_(u(z),{label:e.$t("devices.phone_number")},{default:o(()=>[_(u(F),{modelValue:u(y).values.phone_number,"onUpdate:modelValue":t[1]||(t[1]=e=>u(y).values.phone_number=e),placeholder:e.$t("devices.phone_number"),error:u(y).$v.value.phone_number.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),_(u(z),{label:e.$t("devices.status")},{default:o(()=>[_(u(w),{modelValue:u(y).values.status,"onUpdate:modelValue":t[2]||(t[2]=e=>u(y).values.status=e),options:g,error:u(y).$v.value.status.$error,"label-key":"label","value-key":"value"},null,8,["modelValue","error"])]),_:1},8,["label"])]),m("div",He,[_(u($),{text:e.$t("rejecting.cancel"),variant:"outline",onClick:k,class:"flex-1"},null,8,["text"]),_(u($),{text:e.$t("devices.add"),type:"submit",loading:x.value,class:"flex-1"},null,8,["text","loading"])])],32)]),_:1},8,["title","modelValue"]))}}),Ke=()=>{const{t:e}=l();return[{id:1,name:e("statuses.all_statuses"),key:"all"},{id:2,name:e("devices.status.active"),key:"active"},{id:3,name:e("devices.status.inactive"),key:"inactive"}]},Ne=()=>{const{t:e}=l();return[{title:"â„–",key:"_index"},{title:"ID",key:"id",hasSort:!0},{title:e("devices.name"),key:"name",hasSort:!0},{title:e("devices.model"),key:"model",hasSort:!0},{title:e("devices.phone_number"),key:"phone_number",hasSort:!0},{title:e("devices.battery"),key:"battery",hasSort:!0},{title:e("devices.carrier"),key:"carrier",hasSort:!0},{title:e("devices.status"),key:"status",hasSort:!0},{title:e("devices.availability"),key:"is_available",hasSort:!0},{title:e("devices.actions"),key:"actions",hasSort:!1}]},Oe=()=>{const{t:e}=l();return{noData:{title:e("no_data.title"),subtitle:e("no_data.subtitle"),icon:"icon-phone",hasAction:!1},thClass:"last:!text-left"}},Qe=()=>{const{t:e}=l();return[{id:1,name:e("all"),key:"all"},{id:2,name:"Beeline",key:"beeline"},{id:3,name:"Ucell",key:"ucell"},{id:4,name:"UzMobile",key:"uzmobile"},{id:5,name:"Mobiuz",key:"mobiuz"}]},We=()=>{const{t:e}=l();return[{id:1,name:e("devices.ordering.id_asc"),key:"id"},{id:2,name:e("devices.ordering.id_desc"),key:"-id"},{id:3,name:e("devices.ordering.name_asc"),key:"name"},{id:4,name:e("devices.ordering.name_desc"),key:"-name"},{id:5,name:e("devices.ordering.battery_asc"),key:"battery"},{id:6,name:e("devices.ordering.battery_desc"),key:"-battery"},{id:7,name:e("devices.ordering.created_asc"),key:"created_at"},{id:8,name:e("devices.ordering.created_desc"),key:"-created_at"}]},Xe={class:"bg-white px-6 rounded-xl"},Ye={class:"flex items-center gap-1"},Ze={class:"text-sm font-medium text-dark-black"},et={class:"flex gap-2"},tt={class:"flex gap-5 flex-wrap"},at=g(s({__name:"PDevices",setup(a){const{t:s}=l(),{showToast:i}=b(),c=e("status",s("statuses.all_statuses")),{tableData:r,pagination:y,isLoading:g,onPageChange:f,refetch:w}=B("/explat/devices/",(()=>{const e={};return c.value&&c.value!==s("statuses.all_statuses")&&(e.status=c.value),e})(),["tab"]),C=d(!1),D=()=>{C.value=!0},U=d(!1),S=d("");function z(e){S.value=e.uid,U.value=!0}function F(e){console.log("Device loaded:",e)}function I(e){console.log("Device created:",e),w()}const T=e=>{switch(e){case"active":return"success_status";case"inactive":return"canceled_status";case"maintenance":return"pending_status";case"offline":return"failed_status";default:return""}};return(e,a)=>(n(),v("section",null,[m("div",Xe,[_(u(V),h({data:u(r),head:u(Ne)(),"has-add-button":{title:e.$t("devices.add"),link:"#"},onAdd:D,loading:u(g),title:e.$t("devices.title"),subtitle:e.$t("devices.count",{count:u(y).total}),total:u(y).total,filter:{status:u(Ke)(),carrier:u(Qe)(),ordering:u(We)()}},u(Oe)(),{onClickToRow:z,onPageChange:u(f)}),{id:o(({data:e})=>[m("div",Ye,[m("span",Ze,[k(p(null==e?void 0:e.id)+" ",1),a[2]||(a[2]=m("i",{class:"icon-copy text-primary font-semibold"},null,-1))])])]),name:o(({data:e})=>[k(p(null==e?void 0:e.name),1)]),model:o(({data:e})=>[k(p(null==e?void 0:e.model),1)]),phone_number:o(({data:e})=>[k(p(null==e?void 0:e.phone_number),1)]),battery:o(({data:e})=>[k(p(null==e?void 0:e.battery)+"% ",1)]),carrier:o(({data:e})=>[k(p(null==e?void 0:e.carrier),1)]),status:o(({data:t})=>[m("span",{class:x(T(null==t?void 0:t.status))},p(e.$t(`devices.status.${null==t?void 0:t.status}`)),3)]),is_available:o(({data:t})=>[m("span",{class:x((null==t?void 0:t.is_available)?"text-green-600":"text-red-600")},p((null==t?void 0:t.is_available)?e.$t("devices.available"):e.$t("devices.unavailable")),3)]),actions:o(({data:t})=>[m("div",et,[_(u($),{text:e.$t("devices.health_check"),variant:"outline",size:"sm",onClick:e=>(async e=>{try{await A(e.uid),i(s("devices.health_check_success"),"success"),w()}catch(t){console.error("Error performing health check:",t),i(s("devices.health_check_failed"),"error")}})(t)},null,8,["text","onClick"]),_(u($),{text:"active"===(null==t?void 0:t.status)?e.$t("devices.deactivate"):e.$t("devices.activate"),variant:"active"===(null==t?void 0:t.status)?"neutral":"primary",size:"sm",onClick:e=>(async e=>{try{const t="active"===e.status?"inactive":"active";await E(e.uid,{status:t}),i(s("devices.status_updated"),"success"),w()}catch(t){console.error("Error updating device status:",t),i(s("devices.status_update_failed"),"error")}})(t)},null,8,["text","variant","onClick"]),_(u($),{text:e.$t("devices.delete"),variant:"danger",size:"sm",onClick:e=>(async e=>{if(confirm(s("devices.confirm_delete")))try{await M(e.uid),i(s("devices.deleted_successfully"),"success"),w()}catch(t){console.error("Error deleting device:",t),i(s("devices.delete_failed"),"error")}})(t)},null,8,["text","onClick"])])]),filter:o(()=>[m("div",tt,[_(j,{label:e.$t("interval_of_time")},{default:o(()=>[_(t,{class:"bg-white","start-date-key":"created_at__gte","end-date-key":"created_at__lte"})]),_:1},8,["label"])])]),_:1},16,["data","head","has-add-button","loading","title","subtitle","total","filter","onPageChange"]),_(Je,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),onDeviceCreated:I},null,8,["modelValue"])]),_(Re,{modelValue:U.value,"onUpdate:modelValue":a[1]||(a[1]=e=>U.value=e),"device-uid":S.value,onDeviceLoaded:F},null,8,["modelValue","device-uid"])]))}}),[["__scopeId","data-v-c19063d7"]]);export{at as default};
