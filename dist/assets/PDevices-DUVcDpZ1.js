import{u as K,_ as W}from"./FilterDateRange.vue_vue_type_script_setup_true_lang-B4G5KdfN.js";import{I as w,d as E,x as D,c as N,k as j,y as X,a as R,o as U,w as v,u as l,g as P,b as e,t as i,i as T,n as Y,e as u,z as O,f as H,G as Z,A as ee,C as S}from"./index-8FvB9lgi.js";import{_ as V}from"./BaseButton.vue_vue_type_script_setup_true_lang-CtVDCKKl.js";import{a as te,B as se,_ as ae}from"./FormFilterLabel.vue_vue_type_script_setup_true_lang-C45pJbku.js";import{_ as q}from"./BaseModal.vue_vue_type_script_setup_true_lang-CTAF7Sob.js";import{f as I}from"./common-BG67uGBz.js";import{u as ie,r as M,_ as F}from"./useForm-BdPodcTW.js";import{F as L}from"./FormInput-FCPyqpWb.js";import{u as le}from"./useTableFetch-24INAtW3.js";const z={getDevices:async s=>w.$get("/explat/devices/",{params:s}),getDevice:async s=>w.$get(`/explat/devices/${s}/`),createDevice:async s=>w.$post("/explat/devices/",s),updateDevice:async(s,d)=>w.$put(`/explat/devices/${s}/`,d),patchDevice:async(s,d)=>w.$patch(`/explat/devices/${s}/`,d),deleteDevice:async s=>w.$delete(`/explat/devices/${s}/`),healthCheck:async s=>w.$post(`/explat/devices/${s}/healthcheck/`),sendSMS:async(s,d)=>w.$post(`/explat/devices/${s}/sms-message/`,d)},oe={key:0,class:"space-y-6"},ne={class:"flex items-center justify-between p-4 bg-gray-5 rounded-lg"},ce={class:"flex items-center gap-3"},re={class:"text-lg font-semibold text-dark"},de={class:"text-sm text-gray-1"},ue={class:"text-right"},ve={class:"text-xs text-gray-1 mt-1"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},_e={class:"space-y-4"},pe={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},he={class:"space-y-3"},fe={class:"flex justify-between items-center"},ye={class:"text-sm text-gray-1"},ge={class:"flex items-center gap-2"},be={class:"text-sm font-mono text-dark"},xe={class:"flex justify-between items-center"},$e={class:"text-sm text-gray-1"},ke={class:"text-sm text-dark"},we={class:"flex justify-between items-center"},De={class:"text-sm text-gray-1"},Ce={class:"text-sm text-dark"},Ve={class:"flex justify-between items-center"},Se={class:"text-sm text-gray-1"},je={class:"text-sm text-dark"},Ue={class:"space-y-4"},Te={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},ze={class:"space-y-3"},Be={class:"flex justify-between items-center"},Ie={class:"text-sm text-gray-1"},Me={class:"flex items-center gap-2"},Fe={class:"w-16 bg-gray-4 rounded-full h-2"},Pe={class:"text-sm font-medium text-dark"},Ee={class:"flex justify-between items-center"},Oe={class:"text-sm text-gray-1"},Ae={class:"flex justify-between items-center"},Le={class:"text-sm text-gray-1"},Ne={class:"text-sm text-dark"},Re={class:"space-y-4"},He={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},qe={class:"grid grid-cols-2 gap-4"},Ge={class:"flex justify-between items-center"},Qe={class:"text-sm text-gray-1"},Je={class:"text-sm font-mono text-dark"},Ke={class:"flex justify-between items-center"},We={class:"text-sm text-gray-1"},Xe={class:"text-sm font-mono text-dark"},Ye={class:"space-y-4"},Ze={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},et={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},tt={class:"flex justify-between items-center"},st={class:"text-sm text-gray-1"},at={class:"text-sm text-dark"},it={class:"flex justify-between items-center"},lt={class:"text-sm text-gray-1"},ot={class:"text-sm text-dark"},nt={key:1,class:"flex items-center justify-center py-8"},ct={class:"flex justify-end gap-3"},rt=E({__name:"DeviceDetailsModal",props:{modelValue:{type:Boolean},deviceUid:{}},emits:["update:modelValue","device-loaded"],setup(s,{emit:d}){const _=s,b=d,{t:y}=D(),{showToast:$}=O(),g=N({get:()=>_.modelValue,set:a=>b("update:modelValue",a)}),o=j(null),c=j(!1),x=async()=>{if(_.deviceUid)try{c.value=!0;const a=await z.getDevice(_.deviceUid);o.value=a,b("device-loaded",a)}catch(a){console.error("Error loading device details:",a),$("error",y("devices.error_loading_details"))}finally{c.value=!1}},C=()=>{x()},k=()=>{g.value=!1,o.value=null},r=async a=>{try{await navigator.clipboard.writeText(a),$("success",y("common.copied"))}catch(h){console.error("Failed to copy:",h),$("error",y("common.copy_failed"))}},m=a=>{switch(a){case"active":return"bg-green/10 text-green";case"inactive":return"bg-gray-4 text-gray-8";case"maintenance":return"bg-yellow/10 text-yellow";case"offline":return"bg-red/10 text-red";default:return"bg-gray-4 text-gray-8"}},f=a=>a>50?"bg-green":a>20?"bg-yellow":"bg-red";return X(()=>_.modelValue,a=>{a&&_.deviceUid&&x()}),(a,h)=>(U(),R(l(q),{title:a.$t("devices.details"),modelValue:g.value,"onUpdate:modelValue":h[1]||(h[1]=B=>g.value=B),onClose:k,class:"max-w-2xl"},{footer:v(()=>[e("div",ct,[u(l(V),{text:a.$t("button.close"),variant:"outline",onClick:k},null,8,["text"]),u(l(V),{text:a.$t("devices.refresh"),onClick:C,loading:c.value},null,8,["text","loading"])])]),default:v(()=>[o.value?(U(),P("div",oe,[e("div",ne,[e("div",ce,[h[2]||(h[2]=e("div",{class:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center"},[e("i",{class:"icon-phone text-white text-xl"})],-1)),e("div",null,[e("h3",re,i(o.value.name),1),e("p",de,i(o.value.model),1)])]),e("div",ue,[e("span",{class:T([m(o.value.status),"px-3 py-1 rounded-full text-xs font-medium"])},i(a.$t(`devices.status.${o.value.status}`)),3),e("p",ve,"ID: "+i(o.value.id),1)])]),e("div",me,[e("div",_e,[e("h4",pe,i(a.$t("devices.basic_info")),1),e("div",he,[e("div",fe,[e("span",ye,i(a.$t("devices.uid"))+":",1),e("div",ge,[e("span",be,i(o.value.uid),1),e("i",{class:"icon-copy text-primary cursor-pointer hover:text-blue transition-300",onClick:h[0]||(h[0]=B=>r(o.value.uid))})])]),e("div",xe,[e("span",$e,i(a.$t("devices.phone_number"))+":",1),e("span",ke,i(o.value.phone_number),1)]),e("div",we,[e("span",De,i(a.$t("devices.carrier"))+":",1),e("span",Ce,i(o.value.carrier),1)]),e("div",Ve,[e("span",Se,i(a.$t("devices.user_id"))+":",1),e("span",je,i(o.value.user_id),1)])])]),e("div",Ue,[e("h4",Te,i(a.$t("devices.status_performance")),1),e("div",ze,[e("div",Be,[e("span",Ie,i(a.$t("devices.battery"))+":",1),e("div",Me,[e("div",Fe,[e("div",{class:T(["h-2 rounded-full transition-all duration-300",f(o.value.battery)]),style:Y({width:`${o.value.battery}%`})},null,6)]),e("span",Pe,i(o.value.battery)+"%",1)])]),e("div",Ee,[e("span",Oe,i(a.$t("devices.availability"))+":",1),e("span",{class:T([o.value.is_available?"text-green":"text-red","text-sm font-medium"])},i(o.value.is_available?a.$t("devices.available"):a.$t("devices.unavailable")),3)]),e("div",Ae,[e("span",Le,i(a.$t("devices.last_healthcheck"))+":",1),e("span",Ne,i(l(I)(o.value.healthcheck_at)),1)])])])]),e("div",Re,[e("h4",He,i(a.$t("devices.location")),1),e("div",qe,[e("div",Ge,[e("span",Qe,i(a.$t("devices.latitude"))+":",1),e("span",Je,i(o.value.latitude),1)]),e("div",Ke,[e("span",We,i(a.$t("devices.longitude"))+":",1),e("span",Xe,i(o.value.longitude),1)])])]),e("div",Ye,[e("h4",Ze,i(a.$t("devices.timestamps")),1),e("div",et,[e("div",tt,[e("span",st,i(a.$t("devices.created_at"))+":",1),e("span",at,i(l(I)(o.value.created_at)),1)]),e("div",it,[e("span",lt,i(a.$t("devices.updated_at"))+":",1),e("span",ot,i(l(I)(o.value.updated_at)),1)])])])])):(U(),P("div",nt,[...h[3]||(h[3]=[e("div",{class:"loader"},null,-1)])]))]),_:1},8,["title","modelValue"]))}}),dt=H(rt,[["__scopeId","data-v-71a2ac99"]]),ut={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vt={class:"flex gap-3 mt-6"},mt=E({__name:"AddDeviceModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","device-created"],setup(s,{emit:d}){const _=s,b=d,{t:y}=D(),{showToast:$}=O(),g=N({get:()=>_.modelValue,set:r=>b("update:modelValue",r)}),o=j(!1),c=ie({name:"",phone_number:"",status:"active"},{name:{required:M},phone_number:{required:M},status:{required:M}}),x=[{label:y("devices.status.active"),value:"active"},{label:y("devices.status.inactive"),value:"inactive"}],C=async()=>{if(c.$v.value.$touch(),!c.$v.value.$invalid)try{o.value=!0;const r={name:c.values.name,phone_number:c.values.phone_number,status:c.values.status},m=await z.createDevice(r);$("success",y("devices.device_created_successfully")),b("device-created",m),k()}catch(r){console.error("Error creating device:",r),$("error",y("devices.error_creating_device"))}finally{o.value=!1}},k=()=>{c.values.name="",c.values.phone_number="",c.values.status="active",c.$v.value.$reset(),g.value=!1};return(r,m)=>(U(),R(l(q),{title:r.$t("devices.add"),modelValue:g.value,"onUpdate:modelValue":m[3]||(m[3]=f=>g.value=f),onClose:k,class:"max-w-2xl"},{default:v(()=>[e("form",{onSubmit:Z(C,["prevent"])},[e("div",ut,[u(l(F),{label:r.$t("devices.name")},{default:v(()=>[u(l(L),{modelValue:l(c).values.name,"onUpdate:modelValue":m[0]||(m[0]=f=>l(c).values.name=f),placeholder:r.$t("devices.name"),error:l(c).$v.value.name.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),u(l(F),{label:r.$t("devices.phone_number")},{default:v(()=>[u(l(L),{modelValue:l(c).values.phone_number,"onUpdate:modelValue":m[1]||(m[1]=f=>l(c).values.phone_number=f),placeholder:r.$t("devices.phone_number"),error:l(c).$v.value.phone_number.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),u(l(F),{label:r.$t("devices.status")},{default:v(()=>[u(l(te),{modelValue:l(c).values.status,"onUpdate:modelValue":m[2]||(m[2]=f=>l(c).values.status=f),options:x,error:l(c).$v.value.status.$error,"label-key":"label","value-key":"value"},null,8,["modelValue","error"])]),_:1},8,["label"])]),e("div",vt,[u(l(V),{text:r.$t("rejecting.cancel"),variant:"outline",onClick:k,class:"flex-1"},null,8,["text"]),u(l(V),{text:r.$t("devices.add"),type:"submit",loading:o.value,class:"flex-1"},null,8,["text","loading"])])],32)]),_:1},8,["title","modelValue"]))}}),_t=()=>{const{t:s}=D();return[{id:1,name:s("statuses.all_statuses"),key:"all"},{id:2,name:s("devices.status.active"),key:"active"},{id:3,name:s("devices.status.inactive"),key:"inactive"}]},pt=()=>{const{t:s}=D();return[{title:"â„–",key:"_index"},{title:"ID",key:"id",hasSort:!0},{title:s("devices.name"),key:"name",hasSort:!0},{title:s("devices.model"),key:"model",hasSort:!0},{title:s("devices.phone_number"),key:"phone_number",hasSort:!0},{title:s("devices.battery"),key:"battery",hasSort:!0},{title:s("devices.carrier"),key:"carrier",hasSort:!0},{title:s("devices.status"),key:"status",hasSort:!0},{title:s("devices.availability"),key:"is_available",hasSort:!0},{title:s("devices.actions"),key:"actions",hasSort:!1}]},ht=()=>{const{t:s}=D();return{noData:{title:s("no_data.title"),subtitle:s("no_data.subtitle"),icon:"icon-phone",hasAction:!1},thClass:"last:!text-left"}},ft=()=>{const{t:s}=D();return[{id:1,name:s("all"),key:"all"},{id:2,name:"Beeline",key:"beeline"},{id:3,name:"Ucell",key:"ucell"},{id:4,name:"UzMobile",key:"uzmobile"},{id:5,name:"Mobiuz",key:"mobiuz"}]},yt=()=>{const{t:s}=D();return[{id:1,name:s("devices.ordering.id_asc"),key:"id"},{id:2,name:s("devices.ordering.id_desc"),key:"-id"},{id:3,name:s("devices.ordering.name_asc"),key:"name"},{id:4,name:s("devices.ordering.name_desc"),key:"-name"},{id:5,name:s("devices.ordering.battery_asc"),key:"battery"},{id:6,name:s("devices.ordering.battery_desc"),key:"-battery"},{id:7,name:s("devices.ordering.created_asc"),key:"created_at"},{id:8,name:s("devices.ordering.created_desc"),key:"-created_at"}]},gt={class:"bg-white px-6 rounded-xl"},bt={class:"flex items-center gap-1"},xt={class:"text-sm font-medium text-dark-black"},$t={class:"flex gap-2"},kt={class:"flex gap-5 flex-wrap"},wt=E({__name:"PDevices",setup(s){const{t:d}=D(),{showToast:_}=O(),b=K("status",d("statuses.all_statuses")),y=()=>{const n={};return b.value&&b.value!==d("statuses.all_statuses")&&(n.status=b.value),n},{tableData:$,pagination:g,isLoading:o,onPageChange:c,refetch:x}=le("/explat/devices/",y(),["tab"]),C=j(!1),k=()=>{C.value=!0},r=j(!1),m=j("");function f(n){m.value=n.uid,r.value=!0}function a(n){console.log("Device loaded:",n)}function h(n){console.log("Device created:",n),x()}const B=async n=>{if(confirm(d("devices.confirm_delete")))try{await z.deleteDevice(n.uid),_(d("devices.deleted_successfully"),"success"),x()}catch(p){console.error("Error deleting device:",p),_(d("devices.delete_failed"),"error")}},G=async n=>{try{const p=n.status==="active"?"inactive":"active";await z.patchDevice(n.uid,{status:p}),_(d("devices.status_updated"),"success"),x()}catch(p){console.error("Error updating device status:",p),_(d("devices.status_update_failed"),"error")}},Q=async n=>{try{await z.healthCheck(n.uid),_(d("devices.health_check_success"),"success"),x()}catch(p){console.error("Error performing health check:",p),_(d("devices.health_check_failed"),"error")}},J=n=>{switch(n){case"active":return"success_status";case"inactive":return"canceled_status";case"maintenance":return"pending_status";case"offline":return"failed_status";default:return""}};return(n,p)=>(U(),P("section",null,[e("div",gt,[u(l(se),ee({data:l($),head:l(pt)(),"has-add-button":{title:n.$t("devices.add"),link:"#"},onAdd:k,loading:l(o),title:n.$t("devices.title"),subtitle:n.$t("devices.count",{count:l(g).total}),total:l(g).total,filter:{status:l(_t)(),carrier:l(ft)(),ordering:l(yt)()}},l(ht)(),{onClickToRow:f,onPageChange:l(c)}),{id:v(({data:t})=>[e("div",bt,[e("span",xt,[S(i(t==null?void 0:t.id)+" ",1),p[2]||(p[2]=e("i",{class:"icon-copy text-primary font-semibold"},null,-1))])])]),name:v(({data:t})=>[S(i(t==null?void 0:t.name),1)]),model:v(({data:t})=>[S(i(t==null?void 0:t.model),1)]),phone_number:v(({data:t})=>[S(i(t==null?void 0:t.phone_number),1)]),battery:v(({data:t})=>[S(i(t==null?void 0:t.battery)+"% ",1)]),carrier:v(({data:t})=>[S(i(t==null?void 0:t.carrier),1)]),status:v(({data:t})=>[e("span",{class:T(J(t==null?void 0:t.status))},i(n.$t(`devices.status.${t==null?void 0:t.status}`)),3)]),is_available:v(({data:t})=>[e("span",{class:T(t!=null&&t.is_available?"text-green-600":"text-red-600")},i(t!=null&&t.is_available?n.$t("devices.available"):n.$t("devices.unavailable")),3)]),actions:v(({data:t})=>[e("div",$t,[u(l(V),{text:n.$t("devices.health_check"),variant:"outline",size:"sm",onClick:A=>Q(t)},null,8,["text","onClick"]),u(l(V),{text:(t==null?void 0:t.status)==="active"?n.$t("devices.deactivate"):n.$t("devices.activate"),variant:(t==null?void 0:t.status)==="active"?"neutral":"primary",size:"sm",onClick:A=>G(t)},null,8,["text","variant","onClick"]),u(l(V),{text:n.$t("devices.delete"),variant:"danger",size:"sm",onClick:A=>B(t)},null,8,["text","onClick"])])]),filter:v(()=>[e("div",kt,[u(ae,{label:n.$t("interval_of_time")},{default:v(()=>[u(W,{class:"bg-white","start-date-key":"created_at__gte","end-date-key":"created_at__lte"})]),_:1},8,["label"])])]),_:1},16,["data","head","has-add-button","loading","title","subtitle","total","filter","onPageChange"]),u(mt,{modelValue:C.value,"onUpdate:modelValue":p[0]||(p[0]=t=>C.value=t),onDeviceCreated:h},null,8,["modelValue"])]),u(dt,{modelValue:r.value,"onUpdate:modelValue":p[1]||(p[1]=t=>r.value=t),"device-uid":m.value,onDeviceLoaded:a},null,8,["modelValue","device-uid"])]))}}),It=H(wt,[["__scopeId","data-v-22a0b24c"]]);export{It as default};
