import{u as e,_ as a}from"./FilterDateRange.vue_vue_type_script_setup_true_lang-zYLrnFB7.js";import{d as l,c as t,g as r,o,b as n,n as u,C as d,t as i,I as s,E as m,k as _,l as c,z as v,a as p,w as b,u as h,e as y,J as f,K as $,x as k,L as x,A as g,B as q,f as V}from"./index-pTZ7e48Z.js";import{_ as w}from"./BaseButton.vue_vue_type_script_setup_true_lang-riteCsVf.js";import{a as U,B as j,_ as C}from"./FormFilterLabel.vue_vue_type_script_setup_true_lang-CtwkSkIZ.js";import{_ as S}from"./CAmount.vue_vue_type_script_setup_true_lang-Dl5L1-KQ.js";import{_ as F}from"./CRequisites.vue_vue_type_script_setup_true_lang-BEauJlX-.js";import{u as I,_ as B,r as A}from"./useForm-B8tYdfpU.js";import{F as E}from"./FormInput-CSKp9Vlr.js";import{_ as D}from"./BaseModal.vue_vue_type_script_setup_true_lang-BeCUACXu.js";import{u as L}from"./useTableFetch-DZtLCLei.js";const R={class:"flex flex-col items-center"},T={class:"h-3 rounded-lg w-[150px] border border-primary overflow-hidden"},P={class:"text-sm font-medium text-dark-black"},M={class:"text-sm font-medium text-gray-1"},O=l({__name:"CLimitIndicator",props:{current:{default:0},limit:{default:0}},setup(e){const a=e,l=t(()=>Math.round(a.current/a.limit*100));return(a,t)=>(o(),r("div",R,[n("div",T,[n("div",{style:u(`width: ${l.value}%`),class:"h-full bg-primary"},null,4)]),n("div",null,[n("span",P,i(e.current),1),t[0]||(t[0]=d(" / ",-1)),n("span",M,i(e.limit),1)])]))}}),z=async e=>s.$post("/explat/payment-instruments/",e),J=async()=>s.$get("/explat/banks/"),K=async()=>s.$get("/explat/payment-methods/"),G={class:"grid grid-cols-2 gap-5"},H={class:"flex gap-4 mt-5 w-full"},N=l({__name:"AddRequisiteForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(e){const a=m(e,"modelValue"),{showToast:l}=v(),t=I({device_id:"",bank_id:"",owner_full_name:"",card_number:"",phone_number:"",account_number:"",max_amount:"",payment_method_id:""},{device_id:{required:A},bank_id:{required:A},owner_full_name:{required:A},card_number:{required:A},phone_number:{required:A},account_number:{required:A},max_amount:{required:A},payment_method_id:{required:A}}),r=_([]),u=_([]),i=_(!1);c(async()=>{try{i.value=!0;const e=await J();r.value=e.map(e=>({label:e.name,value:e.id.toString()}));const a=await K();u.value=a.map(e=>({label:e.name,value:e.id.toString()}))}catch(e){console.error("Error loading form data:",e),l("error","Failed to load form data")}finally{i.value=!1}});const s=async()=>{if(t.$v.value.$touch(),!t.$v.value.$invalid)try{i.value=!0;const e={device_id:parseInt(t.values.device_id),bank_id:parseInt(t.values.bank_id),payment_method_id:parseInt(t.values.payment_method_id),owner_full_name:t.values.owner_full_name,card_number:t.values.card_number,phone_number:t.values.phone_number,account_number:t.values.account_number,max_amount:parseInt(t.values.max_amount)};await z(e),l("success","Requisite created successfully"),a.value=!1,t.$reset(),window.dispatchEvent(new CustomEvent("requisite-created"))}catch(e){console.error("Error creating requisite:",e),l("error","Failed to create requisite")}finally{i.value=!1}};return(e,l)=>{const m=$("maska");return o(),p(h(D),{wrpClass:"min-w-[600px]",title:e.$t("add_requisite"),modelValue:a.value,"onUpdate:modelValue":l[10]||(l[10]=e=>a.value=e)},{default:b(()=>[n("div",G,[y(h(B),{label:e.$t("add_requisite_modal.device_id")},{default:b(()=>[y(h(E),{modelValue:h(t).values.device_id,"onUpdate:modelValue":l[0]||(l[0]=e=>h(t).values.device_id=e),placeholder:e.$t("add_requisite_modal.placeholder_device_id"),error:h(t).$v.value.device_id.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),y(h(B),{label:e.$t("add_requisite_modal.bank")},{default:b(()=>[y(h(U),{"label-key":"label","value-key":"value",placeholder:e.$t("banks.choose_bank"),modelValue:h(t).values.bank_id,"onUpdate:modelValue":l[1]||(l[1]=e=>h(t).values.bank_id=e),options:r.value,error:h(t).$v.value.bank_id.$error,onOnSelect:l[2]||(l[2]=e=>h(t).values.bank_id=e)},null,8,["placeholder","modelValue","options","error"])]),_:1},8,["label"]),y(h(B),{label:e.$t("add_requisite_modal.name")},{default:b(()=>[y(h(E),{modelValue:h(t).values.owner_full_name,"onUpdate:modelValue":l[3]||(l[3]=e=>h(t).values.owner_full_name=e),placeholder:e.$t("add_requisite_modal.placeholder_name"),error:h(t).$v.value.owner_full_name.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),y(h(B),{label:e.$t("add_requisite_modal.card_number")},{default:b(()=>[f(y(h(E),{modelValue:h(t).values.card_number,"onUpdate:modelValue":l[4]||(l[4]=e=>h(t).values.card_number=e),placeholder:e.$t("add_requisite_modal.placeholder_card_number"),error:h(t).$v.value.card_number.$error},null,8,["modelValue","placeholder","error"]),[[m,"#### #### #### ####"]])]),_:1},8,["label"]),y(h(B),{label:e.$t("add_requisite_modal.phone_number")},{default:b(()=>[f(y(h(E),{modelValue:h(t).values.phone_number,"onUpdate:modelValue":l[5]||(l[5]=e=>h(t).values.phone_number=e),placeholder:e.$t("add_requisite_modal.placeholder_phone_number"),error:h(t).$v.value.phone_number.$error},null,8,["modelValue","placeholder","error"]),[[m,"+#################"]])]),_:1},8,["label"]),y(h(B),{label:e.$t("add_requisite_modal.account_number")},{default:b(()=>[y(h(E),{type:"number",modelValue:h(t).values.account_number,"onUpdate:modelValue":l[6]||(l[6]=e=>h(t).values.account_number=e),placeholder:e.$t("add_requisite_modal.placeholder_account_number"),error:h(t).$v.value.account_number.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),y(h(B),{label:e.$t("add_requisite_modal.max_check")},{default:b(()=>[y(h(E),{type:"number",modelValue:h(t).values.max_amount,"onUpdate:modelValue":l[7]||(l[7]=e=>h(t).values.max_amount=e),placeholder:e.$t("add_requisite_modal.placeholder_max_check"),error:h(t).$v.value.max_amount.$error},{suffix:b(()=>[...l[11]||(l[11]=[d(" ₽ ",-1)])]),_:1},8,["modelValue","placeholder","error"])]),_:1},8,["label"]),y(h(B),{label:e.$t("add_requisite_modal.payment_method")},{default:b(()=>[y(h(U),{modelValue:h(t).values.payment_method_id,"onUpdate:modelValue":l[8]||(l[8]=e=>h(t).values.payment_method_id=e),error:h(t).$v.value.payment_method_id.$error,"label-key":"label","value-key":"value",placeholder:e.$t("add_requisite_modal.placeholder_payment_method"),options:u.value,onOnSelect:l[9]||(l[9]=e=>h(t).values.payment_method_id=e)},null,8,["modelValue","error","placeholder","options"])]),_:1},8,["label"])]),n("div",H,[y(h(w),{text:e.$t("rejecting.cancel"),variant:"neutral",class:"flex-1"},null,8,["text"]),y(h(w),{onClick:s,text:e.$t("add_requisite"),loading:i.value,class:"flex-1"},null,8,["text","loading"])])]),_:1},8,["title","modelValue"])}}}),Q=()=>{const{t:e}=k();return[{id:1,name:e("conditions.all"),key:"all"},{id:2,name:e("conditions.activate"),key:"success"},{id:3,name:e("conditions.deactivate"),key:"canceled"},{id:4,name:e("conditions.test"),key:"pending"}]},W=()=>{const{t:e}=k();return[{title:"№",key:"_index"},{title:"ID",key:"id",hasSort:!0},{title:e("requisites.requisites"),key:"requisites",hasSort:!0},{title:e("requisites.balance"),key:"balance",hasSort:!0},{title:e("requisites.bank_method"),key:"bank_method",hasSort:!0},{title:e("requisites.indicator"),key:"indicator",hasSort:!0},{title:e("requisites.actions"),key:"actions",hasSort:!0}]},X=()=>{const{t:e}=k();return{noData:{title:e("no_data.title"),subtitle:e("no_data.subtitle"),icon:"icon-card",hasAction:!1},thClass:"last:!text-left"}},Y={class:"bg-white px-6 rounded-xl"},Z={class:"flex items-center gap-1"},ee={class:"text-sm font-medium text-dark-black"},ae={class:"w-full flex items-start"},le={class:"flex gap-5"},te=V(l({__name:"PRequisites",setup(l){const{t:t}=k(),u=e("status",t("conditions.all")),{tableData:s,pagination:m,isLoading:v,onPageChange:p,refetch:f}=L("/explat/payment-instruments/",(()=>{const e={};return u.value&&u.value!==t("conditions.all")&&(e.status=u.value),e})(),["status"]),$=_(!1),V=()=>{$.value=!0},I=_(!1),B=_({});function A(e){I.value=!0,B.value=e}const E=()=>{f()};return c(()=>{window.addEventListener("requisite-created",E)}),x(()=>{window.removeEventListener("requisite-created",E)}),(e,l)=>(o(),r("section",null,[n("div",Y,[y(h(j),g({data:h(s),head:h(W)(),hasAddButton:{title:e.$t("add_requisite")},onAdd:V,loading:h(v),title:e.$t("requisites.title"),subtitle:e.$t("requisites.count",{count:h(m).total}),total:h(m).total,filter:{status:h(u)}},h(X)(),{onClickToRow:A,onPageChange:h(p)}),{id:b(({data:e})=>[n("div",Z,[n("span",ee,[d(i(null==e?void 0:e.id)+" ",1),l[2]||(l[2]=n("i",{class:"icon-copy text-primary font-semibold"},null,-1))])])]),balance:b(({data:e})=>{var a,l,t,r,o,n,u,d;return[y(h(S),{amount:null==(a=null==e?void 0:e.amount)?void 0:a.amount,currency:null==(l=null==e?void 0:e.amount)?void 0:l.currency,crypto:{amount:null==(o=null==(r=null==(t=null==e?void 0:e.amount)?void 0:t.crypto)?void 0:r.USDT)?void 0:o.amount,currency:null==(d=null==(u=null==(n=null==e?void 0:e.amount)?void 0:n.crypto)?void 0:u.USDT)?void 0:d.currency}},null,8,["amount","currency","crypto"])]}),bank_method:b(({data:e})=>{var a;return[n("span",null,i(null==(a=null==e?void 0:e.bank)?void 0:a.name),1)]}),requisites:b(({data:e})=>{var a,l;return[y(h(F),{number:null==e?void 0:e.card_number,name:null==e?void 0:e.owner_full_name,bank:null==(a=null==e?void 0:e.bank)?void 0:a.name,payment_method:null==(l=null==e?void 0:e.payment_method)?void 0:l.name},null,8,["number","name","bank","payment_method"])]}),indicator:b(({data:e})=>[n("div",ae,[y(h(O),{limit:null==e?void 0:e.max_amount,current:null==e?void 0:e.min_amount},null,8,["limit","current"])])]),actions:b(({data:a})=>[y(h(w),{class:"min-w-[200px]",variant:null==a?void 0:a.status,text:e.$t("conditions."+(null==a?void 0:a.status))},null,8,["variant","text"])]),filter:b(()=>[n("div",le,[y(C,{label:e.$t("filter.condition")},{default:b(()=>[y(h(U),{modelValue:h(u),"onUpdate:modelValue":l[0]||(l[0]=e=>q(u)?u.value=e:null),options:h(Q)(),"value-key":"key","option-styles":"hover:bg-gray-6","selected-option-styles":"border-none rounded-lg bg-white",class:"min-w-64"},null,8,["modelValue","options"])]),_:1},8,["label"]),y(C,{label:e.$t("interval_of_time")},{default:b(()=>[y(a,{class:"bg-white","start-date-key":"created_at__gte","end-date-key":"created_at__lte"})]),_:1},8,["label"])])]),_:1},16,["data","head","hasAddButton","loading","title","subtitle","total","filter","onPageChange"]),y(N,{modelValue:$.value,"onUpdate:modelValue":l[1]||(l[1]=e=>$.value=e)},null,8,["modelValue"])])]))}}),[["__scopeId","data-v-7c577def"]]);export{te as default};
