import{_ as e}from"./qr-code-DgjEc1tF.js";import{u as t,_ as a}from"./FilterDateRange.vue_vue_type_script_setup_true_lang-C_1K-rXA.js";import{p as s,H as i,d as l,x as d,c,k as r,L as n,a as o,o as u,w as v,u as m,g as p,b as x,t as y,i as _,n as g,e as b,E as f,f as h,y as k,A as $}from"./index-BAoS1bkF.js";import{_ as w}from"./BaseButton.vue_vue_type_script_setup_true_lang-DdWExcrG.js";import{_ as j}from"./BaseModal.vue_vue_type_script_setup_true_lang-_99Gpcew.js";import{B as C,_ as V}from"./FormFilterLabel.vue_vue_type_script_setup_true_lang-CeBXkYTV.js";import{u as D}from"./useTableFetch-CvU-nN6q.js";import"./FormInput-CzZleLEu.js";function S(e){return s(e).format("DD.MM.YYYY, HH:mm")}const U=async e=>i.$get(`/explat/devices/${e}/`),z=async(e,t)=>i.$patch(`/explat/devices/${e}/`,t),B=async e=>i.$delete(`/explat/devices/${e}/`),F=async e=>i.$post(`/explat/devices/${e}/healthcheck/`),M={key:0,class:"space-y-6"},A={class:"flex items-center justify-between p-4 bg-gray-5 rounded-lg"},E={class:"flex items-center gap-3"},I={class:"text-lg font-semibold text-dark"},T={class:"text-sm text-gray-1"},L={class:"text-right"},P={class:"text-xs text-gray-1 mt-1"},Y={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},H={class:"space-y-4"},q={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},R={class:"space-y-3"},G={class:"flex justify-between items-center"},J={class:"text-sm text-gray-1"},K={class:"flex items-center gap-2"},N={class:"text-sm font-mono text-dark"},O={class:"flex justify-between items-center"},Q={class:"text-sm text-gray-1"},W={class:"text-sm text-dark"},X={class:"flex justify-between items-center"},Z={class:"text-sm text-gray-1"},ee={class:"text-sm text-dark"},te={class:"flex justify-between items-center"},ae={class:"text-sm text-gray-1"},se={class:"text-sm text-dark"},ie={class:"space-y-4"},le={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},de={class:"space-y-3"},ce={class:"flex justify-between items-center"},re={class:"text-sm text-gray-1"},ne={class:"flex items-center gap-2"},oe={class:"w-16 bg-gray-4 rounded-full h-2"},ue={class:"text-sm font-medium text-dark"},ve={class:"flex justify-between items-center"},me={class:"text-sm text-gray-1"},pe={class:"flex justify-between items-center"},xe={class:"text-sm text-gray-1"},ye={class:"text-sm text-dark"},_e={class:"space-y-4"},ge={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},be={class:"grid grid-cols-2 gap-4"},fe={class:"flex justify-between items-center"},he={class:"text-sm text-gray-1"},ke={class:"text-sm font-mono text-dark"},$e={class:"flex justify-between items-center"},we={class:"text-sm text-gray-1"},je={class:"text-sm font-mono text-dark"},Ce={class:"space-y-4"},Ve={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},De={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Se={class:"flex justify-between items-center"},Ue={class:"text-sm text-gray-1"},ze={class:"text-sm text-dark"},Be={class:"flex justify-between items-center"},Fe={class:"text-sm text-gray-1"},Me={class:"text-sm text-dark"},Ae={key:1,class:"flex items-center justify-center py-8"},Ee={class:"flex justify-end gap-3"},Ie=h(l({__name:"DeviceDetailsModal",props:{modelValue:{type:Boolean},deviceUid:{}},emits:["update:modelValue","device-loaded"],setup(e,{emit:t}){const a=e,s=t,{t:i}=d(),{showToast:l}=f(),h=c({get:()=>a.modelValue,set:e=>s("update:modelValue",e)}),k=r(null),$=r(!1),C=async()=>{if(a.deviceUid)try{$.value=!0;const e=await U(a.deviceUid);k.value=e,s("device-loaded",e)}catch(e){console.error("Error loading device details:",e),l("error",i("devices.error_loading_details"))}finally{$.value=!1}},V=()=>{C()},D=()=>{h.value=!1,k.value=null},z=e=>{switch(e){case"active":return"bg-green/10 text-green";case"inactive":default:return"bg-gray-4 text-gray-8";case"maintenance":return"bg-yellow/10 text-yellow";case"offline":return"bg-red/10 text-red"}};return n(()=>a.modelValue,e=>{e&&a.deviceUid&&C()}),(e,t)=>(u(),o(m(j),{title:e.$t("devices.details"),modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=e=>h.value=e),onClose:D,class:"max-w-2xl"},{footer:v(()=>[x("div",Ee,[b(m(w),{text:e.$t("button.close"),variant:"outline",onClick:D},null,8,["text"]),b(m(w),{text:e.$t("devices.refresh"),onClick:V,loading:$.value},null,8,["text","loading"])])]),default:v(()=>{return[k.value?(u(),p("div",M,[x("div",A,[x("div",E,[t[2]||(t[2]=x("div",{class:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center"},[x("i",{class:"icon-phone text-white text-xl"})],-1)),x("div",null,[x("h3",I,y(k.value.name),1),x("p",T,y(k.value.model),1)])]),x("div",L,[x("span",{class:_([z(k.value.status),"px-3 py-1 rounded-full text-xs font-medium"])},y(e.$t(`devices.status.${k.value.status}`)),3),x("p",P,"ID: "+y(k.value.id),1)])]),x("div",Y,[x("div",H,[x("h4",q,y(e.$t("devices.basic_info")),1),x("div",R,[x("div",G,[x("span",J,y(e.$t("devices.uid"))+":",1),x("div",K,[x("span",N,y(k.value.uid),1),x("i",{class:"icon-copy text-primary cursor-pointer hover:text-blue transition-300",onClick:t[0]||(t[0]=e=>(async e=>{try{await navigator.clipboard.writeText(e),l("success",i("common.copied"))}catch(t){console.error("Failed to copy:",t),l("error",i("common.copy_failed"))}})(k.value.uid))})])]),x("div",O,[x("span",Q,y(e.$t("devices.phone_number"))+":",1),x("span",W,y(k.value.phone_number),1)]),x("div",X,[x("span",Z,y(e.$t("devices.carrier"))+":",1),x("span",ee,y(k.value.carrier),1)]),x("div",te,[x("span",ae,y(e.$t("devices.user_id"))+":",1),x("span",se,y(k.value.user_id),1)])])]),x("div",ie,[x("h4",le,y(e.$t("devices.status_performance")),1),x("div",de,[x("div",ce,[x("span",re,y(e.$t("devices.battery"))+":",1),x("div",ne,[x("div",oe,[x("div",{class:_(["h-2 rounded-full transition-all duration-300",(a=k.value.battery,a>50?"bg-green":a>20?"bg-yellow":"bg-red")]),style:g({width:`${k.value.battery}%`})},null,6)]),x("span",ue,y(k.value.battery)+"%",1)])]),x("div",ve,[x("span",me,y(e.$t("devices.availability"))+":",1),x("span",{class:_([k.value.is_available?"text-green":"text-red","text-sm font-medium"])},y(k.value.is_available?e.$t("devices.available"):e.$t("devices.unavailable")),3)]),x("div",pe,[x("span",xe,y(e.$t("devices.last_healthcheck"))+":",1),x("span",ye,y(m(S)(k.value.healthcheck_at)),1)])])])]),x("div",_e,[x("h4",ge,y(e.$t("devices.location")),1),x("div",be,[x("div",fe,[x("span",he,y(e.$t("devices.latitude"))+":",1),x("span",ke,y(k.value.latitude),1)]),x("div",$e,[x("span",we,y(e.$t("devices.longitude"))+":",1),x("span",je,y(k.value.longitude),1)])])]),x("div",Ce,[x("h4",Ve,y(e.$t("devices.timestamps")),1),x("div",De,[x("div",Se,[x("span",Ue,y(e.$t("devices.created_at"))+":",1),x("span",ze,y(m(S)(k.value.created_at)),1)]),x("div",Be,[x("span",Fe,y(e.$t("devices.updated_at"))+":",1),x("span",Me,y(m(S)(k.value.updated_at)),1)])])])])):(u(),p("div",Ae,[...t[3]||(t[3]=[x("div",{class:"loader"},null,-1)])]))];var a}),_:1},8,["title","modelValue"]))}}),[["__scopeId","data-v-71a2ac99"]]),Te=()=>{const{t:e}=d();return[{id:1,name:e("statuses.all_statuses"),key:"all"},{id:2,name:e("devices.status.active"),key:"active"},{id:3,name:e("devices.status.inactive"),key:"inactive"}]},Le=()=>{const{t:e}=d();return[{title:"â„–",key:"_index"},{title:"ID",key:"id",hasSort:!0},{title:e("devices.name"),key:"name",hasSort:!0},{title:e("devices.model"),key:"model",hasSort:!0},{title:e("devices.phone_number"),key:"phone_number",hasSort:!0},{title:e("devices.battery"),key:"battery",hasSort:!0},{title:e("devices.carrier"),key:"carrier",hasSort:!0},{title:e("devices.status"),key:"status",hasSort:!0},{title:e("devices.availability"),key:"is_available",hasSort:!0},{title:e("devices.actions"),key:"actions",hasSort:!1}]},Pe=()=>{const{t:e}=d();return{noData:{title:e("no_data.title"),subtitle:e("no_data.subtitle"),icon:"icon-phone",hasAction:!1},thClass:"last:!text-left"}},Ye=()=>{const{t:e}=d();return[{id:1,name:e("all"),key:"all"},{id:2,name:"Beeline",key:"beeline"},{id:3,name:"Ucell",key:"ucell"},{id:4,name:"UzMobile",key:"uzmobile"},{id:5,name:"Mobiuz",key:"mobiuz"}]},He=()=>{const{t:e}=d();return[{id:1,name:e("devices.ordering.id_asc"),key:"id"},{id:2,name:e("devices.ordering.id_desc"),key:"-id"},{id:3,name:e("devices.ordering.name_asc"),key:"name"},{id:4,name:e("devices.ordering.name_desc"),key:"-name"},{id:5,name:e("devices.ordering.battery_asc"),key:"battery"},{id:6,name:e("devices.ordering.battery_desc"),key:"-battery"},{id:7,name:e("devices.ordering.created_asc"),key:"created_at"},{id:8,name:e("devices.ordering.created_desc"),key:"-created_at"}]},qe={class:"bg-white px-6 rounded-xl"},Re={class:"flex items-center gap-1"},Ge={class:"text-sm font-medium text-dark-black"},Je={class:"flex gap-2"},Ke={class:"flex gap-5 flex-wrap"},Ne=h(l({__name:"PDevices",setup(s){const{t:i}=d(),{showToast:l}=f(),c=t("status",i("statuses.all_statuses")),{tableData:n,pagination:o,isLoading:g,onPageChange:h,refetch:S}=D("/explat/devices/",(()=>{const e={};return c.value&&c.value!==i("statuses.all_statuses")&&(e.status=c.value),e})(),["tab"]),U=r(!1),M=()=>{U.value=!0},A=r(!1),E=r("");function I(e){E.value=e.uid,A.value=!0}function T(e){console.log("Device loaded:",e)}const L=e=>{switch(e){case"active":return"success_status";case"inactive":return"canceled_status";case"maintenance":return"pending_status";case"offline":return"failed_status";default:return""}};return(t,s)=>(u(),p("section",null,[x("div",qe,[b(m(C),k({data:m(n),head:m(Le)(),"has-add-button":{title:t.$t("devices.add"),link:"#"},onAdd:M,loading:m(g),title:t.$t("devices.title"),subtitle:t.$t("devices.count",{count:m(o).total}),total:m(o).total,filter:{status:m(Te)(),carrier:m(Ye)(),ordering:m(He)()}},m(Pe)(),{onClickToRow:I,onPageChange:m(h)}),{id:v(({data:e})=>[x("div",Re,[x("span",Ge,[$(y(null==e?void 0:e.id)+" ",1),s[2]||(s[2]=x("i",{class:"icon-copy text-primary font-semibold"},null,-1))])])]),name:v(({data:e})=>[$(y(null==e?void 0:e.name),1)]),model:v(({data:e})=>[$(y(null==e?void 0:e.model),1)]),phone_number:v(({data:e})=>[$(y(null==e?void 0:e.phone_number),1)]),battery:v(({data:e})=>[$(y(null==e?void 0:e.battery)+"% ",1)]),carrier:v(({data:e})=>[$(y(null==e?void 0:e.carrier),1)]),status:v(({data:e})=>[x("span",{class:_(L(null==e?void 0:e.status))},y(t.$t(`devices.status.${null==e?void 0:e.status}`)),3)]),is_available:v(({data:e})=>[x("span",{class:_((null==e?void 0:e.is_available)?"text-green-600":"text-red-600")},y((null==e?void 0:e.is_available)?t.$t("devices.available"):t.$t("devices.unavailable")),3)]),actions:v(({data:e})=>[x("div",Je,[b(m(w),{text:t.$t("devices.health_check"),variant:"outline",size:"sm",onClick:t=>(async e=>{try{await F(e.uid),l(i("devices.health_check_success"),"success"),S()}catch(t){console.error("Error performing health check:",t),l(i("devices.health_check_failed"),"error")}})(e)},null,8,["text","onClick"]),b(m(w),{text:"active"===(null==e?void 0:e.status)?t.$t("devices.deactivate"):t.$t("devices.activate"),variant:"active"===(null==e?void 0:e.status)?"neutral":"primary",size:"sm",onClick:t=>(async e=>{try{const t="active"===e.status?"inactive":"active";await z(e.uid,{status:t}),l(i("devices.status_updated"),"success"),S()}catch(t){console.error("Error updating device status:",t),l(i("devices.status_update_failed"),"error")}})(e)},null,8,["text","variant","onClick"]),b(m(w),{text:t.$t("devices.delete"),variant:"danger",size:"sm",onClick:t=>(async e=>{if(confirm(i("devices.confirm_delete")))try{await B(e.uid),l(i("devices.deleted_successfully"),"success"),S()}catch(t){console.error("Error deleting device:",t),l(i("devices.delete_failed"),"error")}})(e)},null,8,["text","onClick"])])]),filter:v(()=>[x("div",Ke,[b(V,{label:t.$t("interval_of_time")},{default:v(()=>[b(a,{class:"bg-white","start-date-key":"created_at__gte","end-date-key":"created_at__lte"})]),_:1},8,["label"])])]),_:1},16,["data","head","has-add-button","loading","title","subtitle","total","filter","onPageChange"]),b(m(j),{title:t.$t("devices.add"),modelValue:U.value,"onUpdate:modelValue":s[0]||(s[0]=e=>U.value=e)},{default:v(()=>[s[3]||(s[3]=x("figure",{class:"bg-primary p-5"},[x("img",{src:e,alt:"qr"})],-1)),s[4]||(s[4]=x("p",{class:"text-center"},"ASdle19uh2aAD2d23dasd424f8eisdkh244wie",-1)),b(m(w),{text:t.$t("copy")},null,8,["text"])]),_:1},8,["title","modelValue"])]),b(Ie,{modelValue:A.value,"onUpdate:modelValue":s[1]||(s[1]=e=>A.value=e),"device-uid":E.value,onDeviceLoaded:T},null,8,["modelValue","device-uid"])]))}}),[["__scopeId","data-v-b8c81683"]]);export{Ne as default};
