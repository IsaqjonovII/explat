import{u as K,_ as Q}from"./FilterDateRange.vue_vue_type_script_setup_true_lang-B4G5KdfN.js";import{d as B,c as G,g as O,o as I,b as u,n as W,C as D,t as w,I as _,E as X,k as g,l as j,z as Y,a as Z,w as i,u as e,e as r,J as N,K as ee,x,L as te,A as le,B as ae,f as ne}from"./index-8FvB9lgi.js";import{_ as C}from"./BaseButton.vue_vue_type_script_setup_true_lang-CtVDCKKl.js";import{a as U,B as oe,_ as z}from"./FormFilterLabel.vue_vue_type_script_setup_true_lang-C45pJbku.js";import{_ as re}from"./CAmount.vue_vue_type_script_setup_true_lang-CJbXMlvo.js";import{_ as se}from"./CRequisites.vue_vue_type_script_setup_true_lang-BNSjNOnM.js";import{u as ie,_ as b,r as f}from"./useForm-BdPodcTW.js";import{F as k}from"./FormInput-FCPyqpWb.js";import{_ as ue}from"./BaseModal.vue_vue_type_script_setup_true_lang-CTAF7Sob.js";import{u as de}from"./useTableFetch-24INAtW3.js";const me={class:"flex flex-col items-center"},ce={class:"h-3 rounded-lg w-[150px] border border-primary overflow-hidden"},_e={class:"text-sm font-medium text-dark-black"},pe={class:"text-sm font-medium text-gray-1"},ve=B({__name:"CLimitIndicator",props:{current:{default:0},limit:{default:0}},setup(a){const d=a,m=G(()=>Math.round(d.current/d.limit*100));return(l,y)=>(I(),O("div",me,[u("div",ce,[u("div",{style:W(`width: ${m.value}%`),class:"h-full bg-primary"},null,4)]),u("div",null,[u("span",_e,w(a.current),1),y[0]||(y[0]=D(" / ",-1)),u("span",pe,w(a.limit),1)])]))}}),S={getRequisites:async a=>_.$get("/explat/payment-instruments/",{params:a}),getRequisite:async a=>_.$get(`/explat/payment-instruments/${a}/`),createRequisite:async a=>_.$post("/explat/payment-instruments/",a),updateRequisite:async(a,d)=>_.$put(`/explat/payment-instruments/${a}/`,d),patchRequisite:async(a,d)=>_.$patch(`/explat/payment-instruments/${a}/`,d),deleteRequisite:async a=>_.$delete(`/explat/payment-instruments/${a}/`),activateRequisite:async a=>_.$post(`/explat/payment-instruments/${a}/activate/`),getBanks:async()=>_.$get("/explat/banks/"),getBank:async a=>_.$get(`/explat/banks/${a}/`),getPaymentMethods:async()=>_.$get("/explat/payment-methods/"),getPaymentMethod:async a=>_.$get(`/explat/payment-methods/${a}/`)},be={class:"grid grid-cols-2 gap-5"},fe={class:"flex gap-4 mt-5 w-full"},ye=B({__name:"AddRequisiteForm",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(a){const d=X(a,"modelValue"),{showToast:m}=Y(),l=ie({device_id:"",bank_id:"",owner_full_name:"",card_number:"",phone_number:"",account_number:"",max_amount:"",payment_method_id:""},{device_id:{required:f},bank_id:{required:f},owner_full_name:{required:f},card_number:{required:f},phone_number:{required:f},account_number:{required:f},max_amount:{required:f},payment_method_id:{required:f}}),y=g([]),q=g([]),$=g(!1);j(async()=>{try{$.value=!0;const o=await S.getBanks();y.value=o.map(p=>({label:p.name,value:p.id.toString()}));const n=await S.getPaymentMethods();q.value=n.map(p=>({label:p.name,value:p.id.toString()}))}catch(o){console.error("Error loading form data:",o),m("error","Failed to load form data")}finally{$.value=!1}});const R=async()=>{if(l.$v.value.$touch(),!l.$v.value.$invalid)try{$.value=!0;const o={device_id:parseInt(l.values.device_id),bank_id:parseInt(l.values.bank_id),payment_method_id:parseInt(l.values.payment_method_id),owner_full_name:l.values.owner_full_name,card_number:l.values.card_number,phone_number:l.values.phone_number,account_number:l.values.account_number,max_amount:parseInt(l.values.max_amount)};await S.createRequisite(o),m("success","Requisite created successfully"),d.value=!1,l.$reset(),window.dispatchEvent(new CustomEvent("requisite-created"))}catch(o){console.error("Error creating requisite:",o),m("error","Failed to create requisite")}finally{$.value=!1}};return(o,n)=>{const p=ee("maska");return I(),Z(e(ue),{wrpClass:"min-w-[600px]",title:o.$t("add_requisite"),modelValue:d.value,"onUpdate:modelValue":n[10]||(n[10]=s=>d.value=s)},{default:i(()=>[u("div",be,[r(e(b),{label:o.$t("add_requisite_modal.device_id")},{default:i(()=>[r(e(k),{modelValue:e(l).values.device_id,"onUpdate:modelValue":n[0]||(n[0]=s=>e(l).values.device_id=s),placeholder:o.$t("add_requisite_modal.placeholder_device_id"),error:e(l).$v.value.device_id.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),r(e(b),{label:o.$t("add_requisite_modal.bank")},{default:i(()=>[r(e(U),{"label-key":"label","value-key":"value",placeholder:o.$t("banks.choose_bank"),modelValue:e(l).values.bank_id,"onUpdate:modelValue":n[1]||(n[1]=s=>e(l).values.bank_id=s),options:y.value,error:e(l).$v.value.bank_id.$error,onOnSelect:n[2]||(n[2]=s=>e(l).values.bank_id=s)},null,8,["placeholder","modelValue","options","error"])]),_:1},8,["label"]),r(e(b),{label:o.$t("add_requisite_modal.name")},{default:i(()=>[r(e(k),{modelValue:e(l).values.owner_full_name,"onUpdate:modelValue":n[3]||(n[3]=s=>e(l).values.owner_full_name=s),placeholder:o.$t("add_requisite_modal.placeholder_name"),error:e(l).$v.value.owner_full_name.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),r(e(b),{label:o.$t("add_requisite_modal.card_number")},{default:i(()=>[N(r(e(k),{modelValue:e(l).values.card_number,"onUpdate:modelValue":n[4]||(n[4]=s=>e(l).values.card_number=s),placeholder:o.$t("add_requisite_modal.placeholder_card_number"),error:e(l).$v.value.card_number.$error},null,8,["modelValue","placeholder","error"]),[[p,"#### #### #### ####"]])]),_:1},8,["label"]),r(e(b),{label:o.$t("add_requisite_modal.phone_number")},{default:i(()=>[N(r(e(k),{modelValue:e(l).values.phone_number,"onUpdate:modelValue":n[5]||(n[5]=s=>e(l).values.phone_number=s),placeholder:o.$t("add_requisite_modal.placeholder_phone_number"),error:e(l).$v.value.phone_number.$error},null,8,["modelValue","placeholder","error"]),[[p,"+#################"]])]),_:1},8,["label"]),r(e(b),{label:o.$t("add_requisite_modal.account_number")},{default:i(()=>[r(e(k),{type:"number",modelValue:e(l).values.account_number,"onUpdate:modelValue":n[6]||(n[6]=s=>e(l).values.account_number=s),placeholder:o.$t("add_requisite_modal.placeholder_account_number"),error:e(l).$v.value.account_number.$error},null,8,["modelValue","placeholder","error"])]),_:1},8,["label"]),r(e(b),{label:o.$t("add_requisite_modal.max_check")},{default:i(()=>[r(e(k),{type:"number",modelValue:e(l).values.max_amount,"onUpdate:modelValue":n[7]||(n[7]=s=>e(l).values.max_amount=s),placeholder:o.$t("add_requisite_modal.placeholder_max_check"),error:e(l).$v.value.max_amount.$error},{suffix:i(()=>[...n[11]||(n[11]=[D(" ₽ ",-1)])]),_:1},8,["modelValue","placeholder","error"])]),_:1},8,["label"]),r(e(b),{label:o.$t("add_requisite_modal.payment_method")},{default:i(()=>[r(e(U),{modelValue:e(l).values.payment_method_id,"onUpdate:modelValue":n[8]||(n[8]=s=>e(l).values.payment_method_id=s),error:e(l).$v.value.payment_method_id.$error,"label-key":"label","value-key":"value",placeholder:o.$t("add_requisite_modal.placeholder_payment_method"),options:q.value,onOnSelect:n[9]||(n[9]=s=>e(l).values.payment_method_id=s)},null,8,["modelValue","error","placeholder","options"])]),_:1},8,["label"])]),u("div",fe,[r(e(C),{text:o.$t("rejecting.cancel"),variant:"neutral",class:"flex-1"},null,8,["text"]),r(e(C),{onClick:R,text:o.$t("add_requisite"),loading:$.value,class:"flex-1"},null,8,["text","loading"])])]),_:1},8,["title","modelValue"])}}}),$e=()=>{const{t:a}=x();return[{id:1,name:a("conditions.all"),key:"all"},{id:2,name:a("conditions.activate"),key:"success"},{id:3,name:a("conditions.deactivate"),key:"canceled"},{id:4,name:a("conditions.test"),key:"pending"}]},he=()=>{const{t:a}=x();return[{title:"№",key:"_index"},{title:"ID",key:"id",hasSort:!0},{title:a("requisites.requisites"),key:"requisites",hasSort:!0},{title:a("requisites.balance"),key:"balance",hasSort:!0},{title:a("requisites.bank_method"),key:"bank_method",hasSort:!0},{title:a("requisites.indicator"),key:"indicator",hasSort:!0},{title:a("requisites.actions"),key:"actions",hasSort:!0}]},ke=()=>{const{t:a}=x();return{noData:{title:a("no_data.title"),subtitle:a("no_data.subtitle"),icon:"icon-card",hasAction:!1},thClass:"last:!text-left"}},ge={class:"bg-white px-6 rounded-xl"},qe={class:"flex items-center gap-1"},Ve={class:"text-sm font-medium text-dark-black"},we={class:"w-full flex items-start"},xe={class:"flex gap-5"},Re=B({__name:"PRequisites",setup(a){const{t:d}=x(),m=K("status",d("conditions.all")),l=()=>{const c={};return m.value&&m.value!==d("conditions.all")&&(c.status=m.value),c},{tableData:y,pagination:q,isLoading:$,onPageChange:R,refetch:o}=de("/explat/payment-instruments/",l(),["status"]),n=g(!1),p=()=>{n.value=!0},s=g(!1),H=g({});function J(c){s.value=!0,H.value=c}const M=()=>{o()};return j(()=>{window.addEventListener("requisite-created",M)}),te(()=>{window.removeEventListener("requisite-created",M)}),(c,h)=>(I(),O("section",null,[u("div",ge,[r(e(oe),le({data:e(y),head:e(he)(),hasAddButton:{title:c.$t("add_requisite")},onAdd:p,loading:e($),title:c.$t("requisites.title"),subtitle:c.$t("requisites.count",{count:e(q).total}),total:e(q).total,filter:{status:e(m)}},e(ke)(),{onClickToRow:J,onPageChange:e(R)}),{id:i(({data:t})=>[u("div",qe,[u("span",Ve,[D(w(t==null?void 0:t.id)+" ",1),h[2]||(h[2]=u("i",{class:"icon-copy text-primary font-semibold"},null,-1))])])]),balance:i(({data:t})=>{var v,V,P,T,E,F,A,L;return[r(e(re),{amount:(v=t==null?void 0:t.amount)==null?void 0:v.amount,currency:(V=t==null?void 0:t.amount)==null?void 0:V.currency,crypto:{amount:(E=(T=(P=t==null?void 0:t.amount)==null?void 0:P.crypto)==null?void 0:T.USDT)==null?void 0:E.amount,currency:(L=(A=(F=t==null?void 0:t.amount)==null?void 0:F.crypto)==null?void 0:A.USDT)==null?void 0:L.currency}},null,8,["amount","currency","crypto"])]}),bank_method:i(({data:t})=>{var v;return[u("span",null,w((v=t==null?void 0:t.bank)==null?void 0:v.name),1)]}),requisites:i(({data:t})=>{var v,V;return[r(e(se),{number:t==null?void 0:t.card_number,name:t==null?void 0:t.owner_full_name,bank:(v=t==null?void 0:t.bank)==null?void 0:v.name,payment_method:(V=t==null?void 0:t.payment_method)==null?void 0:V.name},null,8,["number","name","bank","payment_method"])]}),indicator:i(({data:t})=>[u("div",we,[r(e(ve),{limit:t==null?void 0:t.max_amount,current:t==null?void 0:t.min_amount},null,8,["limit","current"])])]),actions:i(({data:t})=>[r(e(C),{class:"min-w-[200px]",variant:t==null?void 0:t.status,text:c.$t("conditions."+(t==null?void 0:t.status))},null,8,["variant","text"])]),filter:i(()=>[u("div",xe,[r(z,{label:c.$t("filter.condition")},{default:i(()=>[r(e(U),{modelValue:e(m),"onUpdate:modelValue":h[0]||(h[0]=t=>ae(m)?m.value=t:null),options:e($e)(),"value-key":"key","option-styles":"hover:bg-gray-6","selected-option-styles":"border-none rounded-lg bg-white",class:"min-w-64"},null,8,["modelValue","options"])]),_:1},8,["label"]),r(z,{label:c.$t("interval_of_time")},{default:i(()=>[r(Q,{class:"bg-white","start-date-key":"created_at__gte","end-date-key":"created_at__lte"})]),_:1},8,["label"])])]),_:1},16,["data","head","hasAddButton","loading","title","subtitle","total","filter","onPageChange"]),r(ye,{modelValue:n.value,"onUpdate:modelValue":h[1]||(h[1]=t=>n.value=t)},null,8,["modelValue"])])]))}}),Fe=ne(Re,[["__scopeId","data-v-128484ee"]]);export{Fe as default};
