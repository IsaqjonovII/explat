import{u as N,_ as P}from"./FilterDateRange.vue_vue_type_script_setup_true_lang-B4G5KdfN.js";import{d as A,D as q,x as D,E as H,k,g as h,o as f,b as e,G as V,i as S,u as a,C as F,t as r,z as L,e as d,a as U,v as I,H as X,w as m,c as Z,y as G,f as O,A as J}from"./index-8FvB9lgi.js";import{_ as Q}from"./CAmount.vue_vue_type_script_setup_true_lang-CJbXMlvo.js";import{_ as W}from"./CDevice.vue_vue_type_script_setup_true_lang-C-DWbzro.js";import{_ as K}from"./CRequisites.vue_vue_type_script_setup_true_lang-BNSjNOnM.js";import{u as Y,B as ee,_ as te}from"./FormFilterLabel.vue_vue_type_script_setup_true_lang-C45pJbku.js";import{_ as se}from"./DateTime.vue_vue_type_script_setup_true_lang-CReYMwKP.js";import{_ as j}from"./BaseButton.vue_vue_type_script_setup_true_lang-CtVDCKKl.js";import{u as ae,_ as M,r as B}from"./useForm-BdPodcTW.js";import{F as le}from"./FormInput-FCPyqpWb.js";import{_ as R}from"./BaseModal.vue_vue_type_script_setup_true_lang-CTAF7Sob.js";import{u as oe}from"./useTableFetch-24INAtW3.js";import{f as C}from"./common-BG67uGBz.js";const ne={class:"h-60 w-full"},re={class:"rounded-lg h-full w-full group"},ie=["src"],de=["for"],ue={class:"font-medium mt-5 mb-2 text-dark group-hover:text-blue transition-300"},pe={class:"text-xs leading-4 text-gray-1 font-medium"},ce=["id"],me=A({__name:"BaseImageUploader",props:q({id:{},error:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(i){const{showToast:g}=L(),{t:c}=D(),{isOpen:x,toggle:b}=Y(),_=H(i,"modelValue"),u=k("");function t(o){const s=o.target.files;s&&s[0]&&p(s[0])}function p(o){if(!o.type.startsWith("image/")){g(c("toast.invalid_file_type"),"error");return}if(o.size>31457280){g(c("toast.max_size_error"),"error");return}u.value=URL.createObjectURL(o),_.value=o}function w(){_.value=null,u.value=""}function y(){b()}function $(o){o.preventDefault()}function l(o){var v;o.preventDefault();const s=(v=o.dataTransfer)==null?void 0:v.files;s&&s[0]&&p(s[0])}return(o,s)=>(f(),h("div",ne,[(f(),h("div",{key:_.value,class:"w-full h-full bg-white rounded-xl"},[u.value?(f(),h("div",{key:0,class:"relative rounded-lg h-full w-full",draggable:"true",onDragstart:y,onDragover:V($,["prevent"]),onDrop:V(l,["prevent"])},[e("div",re,[e("div",{class:"cursor-pointer absolute z-10 top-3 right-3 size-10 rounded-md bg-dark/40 backdrop-blur border border-white/30 flex-center",onClick:w},[...s[2]||(s[2]=[e("span",{class:"icon-trash text-white text-xl"},null,-1)])]),e("img",{src:u.value,alt:"image",class:"rounded-lg h-full w-full relative z-[1] object-center object-cover aspect-square"},null,8,ie)])],32)):(f(),h("label",{key:1,class:S([{"border-blue":a(x),"!border-red":i.error},"h-full w-full text-center bg-stone-1 rounded-lg p-6 max-sm:p-1 border-grey-2 border flex justify-center items-center flex-col cursor-pointer transition-300 hover:border-dashed hover:border-blue hover:bg-[#2088FF14] group"]),for:i.id||"image-uploader-input",onDragover:s[0]||(s[0]=V((...v)=>o.onDragOver&&o.onDragOver(...v),["prevent"])),onDragleave:s[1]||(s[1]=V((...v)=>o.onDragLeave&&o.onDragLeave(...v),["prevent"])),onDrop:V(l,["prevent"])},[e("span",ue,[s[3]||(s[3]=e("i",{class:"icon-photo-plus group-hover:text-blue text-xl align-middle text-gray-1"},null,-1)),F(" "+r(o.$t("form.upload.add_photo")),1)]),e("p",pe,r(o.$t("form.upload.max_size_photo")),1)],42,de)),e("input",{id:i.id||"image-uploader-input",ref:"input",accept:"image/*",class:"file hidden",type:"file",onChange:t},null,40,ce)]))]))}}),_e=()=>{const{t:i}=D();return[{title:"№",key:"_index"},{title:"ID",key:"id",hasSort:!0},{title:i("appeals.amount"),key:"amount",hasSort:!0},{title:i("appeals.device"),key:"device",hasSort:!0},{title:i("appeals.payment_method"),key:"payment_method",hasSort:!0},{title:i("appeals.date"),key:"date",hasSort:!0},{title:i("appeals.actions"),key:"actions",hasSort:!0}]},fe=()=>{const{t:i}=D();return{noData:{title:i("transactions_not_found"),subtitle:i("transactions_not_found_try_again_later"),image:"/images/no-data/transactions.png"},thClass:"last:!text-left"}},ve={class:"flex items-center gap-2"},ge={class:"flex gap-1 flex-col items-start"},xe={class:"hover:bg-gray-100 p-1 rounded-[3px] w-full text-left"},be={class:"hover:bg-gray-100 p-1 rounded-[3px] w-full text-left"},he={class:"flex gap-2"},ye=A({__name:"CAction",props:{approve:{},reject:{}},emits:["approve","reject"],setup(i,{emit:g}){const c=ae({reject_reason:"",file:""},{reject_reason:{required:B},file:{required:B}}),x=g,b=k(!1),_=k(!1);return(u,t)=>(f(),h("div",ve,[d(a(X),{modelValue:b.value,"onUpdate:modelValue":[t[0]||(t[0]=p=>b.value=p),t[1]||(t[1]=p=>x("approve"))]},{trigger:m(()=>[i.approve?(f(),U(a(j),{key:0,class:"!px-2 min-w-[150px] !py-1.5 !text-sm !text-white !bg-green !rounded-lg",text:i.approve},null,8,["text"])):I("",!0)]),body:m(()=>[e("div",ge,[e("button",xe,r(u.$t("part")),1),e("button",be,r(u.$t("reject1")),1)])]),_:1},8,["modelValue"]),i.reject?(f(),U(a(j),{key:0,onClick:t[2]||(t[2]=p=>_.value=!0),class:"!px-2 min-w-[150px] !py-1.5 !text-sm !text-white !bg-red-light !rounded-lg",text:i.reject},null,8,["text"])):I("",!0),d(a(R),{title:u.$t("reject_info"),modelValue:_.value,"onUpdate:modelValue":t[6]||(t[6]=p=>_.value=p)},{default:m(()=>[d(a(M),{label:u.$t("rejecting.title")},{default:m(()=>[d(a(le),{modelValue:a(c).values.reject_reason,"onUpdate:modelValue":t[3]||(t[3]=p=>a(c).values.reject_reason=p),placeholder:u.$t("rejecting.title_text")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d(a(M),{label:u.$t("rejecting.file")},{default:m(()=>[d(a(me),{id:"reject-file",modelValue:a(c).values.file,"onUpdate:modelValue":t[4]||(t[4]=p=>a(c).values.file=p)},null,8,["modelValue"])]),_:1},8,["label"]),e("div",he,[d(a(j),{onClick:t[5]||(t[5]=p=>_.value=!1),text:u.$t("rejecting.cancel"),variant:"neutral",class:"flex-1"},null,8,["text"]),d(a(j),{text:u.$t("rejecting.reject"),variant:"danger",class:"flex-1"},null,8,["text"])])]),_:1},8,["title","modelValue"])]))}}),$e={key:0,class:"space-y-6"},je={class:"flex items-center justify-between p-4 bg-gray-5 rounded-lg"},ke={class:"flex items-center gap-3"},we={class:"text-lg font-semibold text-dark"},Ve={class:"text-sm text-gray-1"},De={class:"text-right"},Ae={class:"text-xs text-gray-1 mt-1"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Se={class:"space-y-4"},Ue={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},Ie={class:"space-y-3"},Te={class:"flex justify-between items-center"},ze={class:"text-sm text-gray-1"},Me={class:"text-sm text-dark"},Be={class:"flex justify-between items-center"},Fe={class:"text-sm text-gray-1"},Le={class:"text-sm text-dark"},Oe={class:"flex justify-between items-center"},Re={class:"text-sm text-gray-1"},Ee={class:"text-sm text-dark"},Ne={class:"space-y-4"},Pe={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},qe={class:"space-y-3"},He={class:"flex justify-between items-center"},Xe={class:"text-sm text-gray-1"},Ze={class:"flex gap-2"},Ge={key:0,class:"space-y-4"},Je={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},Qe={class:"p-4 bg-gray-5 rounded-lg"},We={class:"text-sm text-dark"},Ke={class:"space-y-4"},Ye={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},et={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},tt={class:"flex justify-between items-center"},st={class:"text-sm text-gray-1"},at={class:"text-sm text-dark"},lt={class:"flex justify-between items-center"},ot={class:"text-sm text-gray-1"},nt={class:"text-sm text-dark"},rt={key:1,class:"flex items-center justify-center py-8"},it={class:"flex justify-end gap-3"},dt=A({__name:"AppealDetailsModal",props:{modelValue:{type:Boolean},appealUid:{}},emits:["update:modelValue","appeal-updated"],setup(i,{emit:g}){const c=i,x=g,{t:b}=D(),{showToast:_}=L(),u=Z({get:()=>c.modelValue,set:l=>x("update:modelValue",l)}),t=k(null),p=()=>{u.value=!1,t.value=null},w=()=>{_("success",b("appeals.approved_successfully")),t.value&&(t.value.status="accepted",x("appeal-updated",t.value))},y=()=>{_("success",b("appeals.rejected_successfully")),t.value&&(t.value.status="rejected",x("appeal-updated",t.value))},$=l=>{switch(l){case"in_review":return"bg-yellow/10 text-yellow";case"accepted":return"bg-green/10 text-green";case"rejected":return"bg-red/10 text-red";default:return"bg-gray-4 text-gray-8"}};return G(()=>c.modelValue,l=>{l&&c.appealUid}),(l,o)=>(f(),U(a(R),{title:l.$t("appeals.details"),modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=s=>u.value=s),onClose:p,class:"max-w-2xl"},{footer:m(()=>[e("div",it,[d(a(j),{text:l.$t("button.close"),variant:"outline",onClick:p},null,8,["text"])])]),default:m(()=>[t.value?(f(),h("div",$e,[e("div",je,[e("div",ke,[o[1]||(o[1]=e("div",{class:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center"},[e("i",{class:"icon-document text-white text-xl"})],-1)),e("div",null,[e("h3",we," Appeal #"+r(t.value.id),1),e("p",Ve,r(t.value.uid),1)])]),e("div",De,[e("span",{class:S([$(t.value.status),"px-3 py-1 rounded-full text-xs font-medium"])},r(l.$t(`appeals.status.${t.value.status}`)),3),e("p",Ae,"UID: "+r(t.value.uid),1)])]),e("div",Ce,[e("div",Se,[e("h4",Ue,r(l.$t("appeals.basic_info")),1),e("div",Ie,[e("div",Te,[e("span",ze,r(l.$t("appeals.text"))+":",1),e("span",Me,r(t.value.text),1)]),e("div",Be,[e("span",Fe,r(l.$t("appeals.file"))+":",1),e("span",Le,r(t.value.file?l.$t("appeals.file_attached"):l.$t("appeals.no_file")),1)]),e("div",Oe,[e("span",Re,r(l.$t("appeals.action_time"))+":",1),e("span",Ee,r(t.value.action_time?a(C)(t.value.action_time):l.$t("appeals.no_action_time")),1)])])]),e("div",Ne,[e("h4",Pe,r(l.$t("appeals.status_actions")),1),e("div",qe,[e("div",He,[e("span",Xe,r(l.$t("appeals.status"))+":",1),e("span",{class:S([$(t.value.status),"px-2 py-1 rounded text-xs font-medium"])},r(l.$t(`appeals.status.${t.value.status}`)),3)]),e("div",Ze,[d(a(j),{text:l.$t("approve"),variant:"success",size:"sm",onClick:w,disabled:t.value.status!=="in_review"},null,8,["text","disabled"]),d(a(j),{text:l.$t("reject"),variant:"danger",size:"sm",onClick:y,disabled:t.value.status!=="in_review"},null,8,["text","disabled"])])])])]),t.value.payment_instrument_json?(f(),h("div",Ge,[e("h4",Je,r(l.$t("appeals.payment_instrument")),1),e("div",Qe,[e("pre",We,r(JSON.stringify(t.value.payment_instrument_json,null,2)),1)])])):I("",!0),e("div",Ke,[e("h4",Ye,r(l.$t("appeals.timestamps")),1),e("div",et,[e("div",tt,[e("span",st,r(l.$t("appeals.created_at"))+":",1),e("span",at,r(a(C)(t.value.created_at)),1)]),e("div",lt,[e("span",ot,r(l.$t("appeals.updated_at"))+":",1),e("span",nt,r(a(C)(t.value.updated_at)),1)])])])])):(f(),h("div",rt,[...o[2]||(o[2]=[e("div",{class:"loader"},null,-1)])]))]),_:1},8,["title","modelValue"]))}}),ut=O(dt,[["__scopeId","data-v-6a89b459"]]),pt={class:"bg-white px-6 rounded-xl"},ct={class:"flex items-center gap-1"},mt={class:"text-sm font-medium text-dark-black"},_t={class:"flex gap-5"},ft=A({__name:"PAppeals",setup(i){const{t:g}=D(),c=N("status",g("statuses.all_statuses")),x=()=>{const s={};return c.value&&c.value!==g("statuses.all_statuses")&&(s.status=c.value),s},{tableData:b,pagination:_,isLoading:u,refetch:t}=oe("/explat/appeals/",x(),["tab"]),p=()=>{console.log("asd")},w=s=>{console.log(s)},y=k(!1),$=k("");function l(s){$.value=s.uid,y.value=!0}function o(s){console.log("Appeal updated:",s),t()}return(s,v)=>{var T,z;return f(),h("section",null,[e("div",pt,[d(a(ee),J({data:a(b),head:a(_e)(),loading:a(u),title:s.$t("appeals.title"),subtitle:s.$t("appeals.count",{count:((T=a(_))==null?void 0:T.count)||0}),total:((z=a(_))==null?void 0:z.count)||0,filter:{status:a(c)}},a(fe)(),{onClickToRow:l}),{id:m(({data:n})=>[e("div",ct,[e("span",mt,[F(r(n==null?void 0:n.id)+" ",1),v[1]||(v[1]=e("i",{class:"icon-copy text-primary font-semibold"},null,-1))])])]),amount:m(({data:n})=>[d(a(Q),{amount:0,currency:"₽"})]),device:m(({data:n})=>[d(a(W),{title:"Appeal",id:n==null?void 0:n.id},null,8,["id"])]),payment_method:m(({data:n})=>[d(a(K),{number:n==null?void 0:n.uid,name:"Appeal",bank:"System",payment_method:n==null?void 0:n.status},null,8,["number","payment_method"])]),actions:m(({data:n})=>[d(ye,{approve:s.$t("approve"),reject:s.$t("reject"),onApprove:E=>p(n),onReject:E=>w(n)},null,8,["approve","reject","onApprove","onReject"])]),date:m(({data:n})=>[d(se,{date:n==null?void 0:n.created_at,time:n==null?void 0:n.created_at},null,8,["date","time"])]),filter:m(()=>[e("div",_t,[d(te,{label:s.$t("interval_of_time")},{default:m(()=>[d(P,{class:"bg-white","start-date-key":"created_at__gte","end-date-key":"created_at__lte"})]),_:1},8,["label"])])]),_:1},16,["data","head","loading","title","subtitle","total","filter"])]),d(ut,{modelValue:y.value,"onUpdate:modelValue":v[0]||(v[0]=n=>y.value=n),"appeal-uid":$.value,onAppealUpdated:o},null,8,["modelValue","appeal-uid"])])}}}),Ct=O(ft,[["__scopeId","data-v-00194744"]]);export{Ct as default};
