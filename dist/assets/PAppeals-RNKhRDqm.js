import{u as e,_ as t}from"./FilterDateRange.vue_vue_type_script_setup_true_lang-zYLrnFB7.js";import{d as a,D as l,x as s,E as r,k as o,g as u,o as i,b as n,G as d,i as p,u as c,C as m,t as v,z as _,e as x,a as g,v as f,H as y,w as b,c as h,y as j,f as k,A as w}from"./index-pTZ7e48Z.js";import{_ as $}from"./CAmount.vue_vue_type_script_setup_true_lang-Dl5L1-KQ.js";import{_ as V}from"./CDevice.vue_vue_type_script_setup_true_lang-BJ2XIEqB.js";import{_ as D}from"./CRequisites.vue_vue_type_script_setup_true_lang-BEauJlX-.js";import{u as C,B as U,_ as A}from"./FormFilterLabel.vue_vue_type_script_setup_true_lang-CtwkSkIZ.js";import{_ as z}from"./DateTime.vue_vue_type_script_setup_true_lang-CWhd0pgK.js";import{_ as F}from"./BaseButton.vue_vue_type_script_setup_true_lang-riteCsVf.js";import{u as S,_ as B,r as R}from"./useForm-B8tYdfpU.js";import{F as I}from"./FormInput-CSKp9Vlr.js";import{_ as L}from"./BaseModal.vue_vue_type_script_setup_true_lang-BeCUACXu.js";import{u as T}from"./useTableFetch-DZtLCLei.js";import{f as q}from"./common-DgFtQOvP.js";const O={class:"h-60 w-full"},M={class:"rounded-lg h-full w-full group"},E=["src"],G=["for"],H={class:"font-medium mt-5 mb-2 text-dark group-hover:text-blue transition-300"},J={class:"text-xs leading-4 text-gray-1 font-medium"},N=["id"],P=a({__name:"BaseImageUploader",props:l({id:{},error:{type:Boolean}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const{showToast:t}=_(),{t:a}=s(),{isOpen:l,toggle:x}=C(),g=r(e,"modelValue"),f=o("");function y(e){const t=e.target.files;t&&t[0]&&b(t[0])}function b(e){e.type.startsWith("image/")?e.size>31457280?t(a("toast.max_size_error"),"error"):(f.value=URL.createObjectURL(e),g.value=e):t(a("toast.invalid_file_type"),"error")}function h(){g.value=null,f.value=""}function j(){x()}function k(e){e.preventDefault()}function w(e){var t;e.preventDefault();const a=null==(t=e.dataTransfer)?void 0:t.files;a&&a[0]&&b(a[0])}return(t,a)=>(i(),u("div",O,[(i(),u("div",{key:g.value,class:"w-full h-full bg-white rounded-xl"},[f.value?(i(),u("div",{key:0,class:"relative rounded-lg h-full w-full",draggable:"true",onDragstart:j,onDragover:d(k,["prevent"]),onDrop:d(w,["prevent"])},[n("div",M,[n("div",{class:"cursor-pointer absolute z-10 top-3 right-3 size-10 rounded-md bg-dark/40 backdrop-blur border border-white/30 flex-center",onClick:h},[...a[2]||(a[2]=[n("span",{class:"icon-trash text-white text-xl"},null,-1)])]),n("img",{src:f.value,alt:"image",class:"rounded-lg h-full w-full relative z-[1] object-center object-cover aspect-square"},null,8,E)])],32)):(i(),u("label",{key:1,class:p([{"border-blue":c(l),"!border-red":e.error},"h-full w-full text-center bg-stone-1 rounded-lg p-6 max-sm:p-1 border-grey-2 border flex justify-center items-center flex-col cursor-pointer transition-300 hover:border-dashed hover:border-blue hover:bg-[#2088FF14] group"]),for:e.id||"image-uploader-input",onDragover:a[0]||(a[0]=d((...e)=>t.onDragOver&&t.onDragOver(...e),["prevent"])),onDragleave:a[1]||(a[1]=d((...e)=>t.onDragLeave&&t.onDragLeave(...e),["prevent"])),onDrop:d(w,["prevent"])},[n("span",H,[a[3]||(a[3]=n("i",{class:"icon-photo-plus group-hover:text-blue text-xl align-middle text-gray-1"},null,-1)),m(" "+v(t.$t("form.upload.add_photo")),1)]),n("p",J,v(t.$t("form.upload.max_size_photo")),1)],42,G)),n("input",{id:e.id||"image-uploader-input",ref:"input",accept:"image/*",class:"file hidden",type:"file",onChange:y},null,40,N)]))]))}}),W=()=>{const{t:e}=s();return[{title:"№",key:"_index"},{title:"ID",key:"id",hasSort:!0},{title:e("appeals.amount"),key:"amount",hasSort:!0},{title:e("appeals.device"),key:"device",hasSort:!0},{title:e("appeals.payment_method"),key:"payment_method",hasSort:!0},{title:e("appeals.date"),key:"date",hasSort:!0},{title:e("appeals.actions"),key:"actions",hasSort:!0}]},K=()=>{const{t:e}=s();return{noData:{title:e("transactions_not_found"),subtitle:e("transactions_not_found_try_again_later"),image:"/images/no-data/transactions.png"},thClass:"last:!text-left"}},Q={class:"flex items-center gap-2"},X={class:"flex gap-1 flex-col items-start"},Y={class:"hover:bg-gray-100 p-1 rounded-[3px] w-full text-left"},Z={class:"hover:bg-gray-100 p-1 rounded-[3px] w-full text-left"},ee={class:"flex gap-2"},te=a({__name:"CAction",props:{approve:{},reject:{}},emits:["approve","reject"],setup(e,{emit:t}){const a=S({reject_reason:"",file:""},{reject_reason:{required:R},file:{required:R}}),l=t,s=o(!1),r=o(!1);return(t,o)=>(i(),u("div",Q,[x(c(y),{modelValue:s.value,"onUpdate:modelValue":[o[0]||(o[0]=e=>s.value=e),o[1]||(o[1]=e=>l("approve"))]},{trigger:b(()=>[e.approve?(i(),g(c(F),{key:0,class:"!px-2 min-w-[150px] !py-1.5 !text-sm !text-white !bg-green !rounded-lg",text:e.approve},null,8,["text"])):f("",!0)]),body:b(()=>[n("div",X,[n("button",Y,v(t.$t("part")),1),n("button",Z,v(t.$t("reject1")),1)])]),_:1},8,["modelValue"]),e.reject?(i(),g(c(F),{key:0,onClick:o[2]||(o[2]=e=>r.value=!0),class:"!px-2 min-w-[150px] !py-1.5 !text-sm !text-white !bg-red-light !rounded-lg",text:e.reject},null,8,["text"])):f("",!0),x(c(L),{title:t.$t("reject_info"),modelValue:r.value,"onUpdate:modelValue":o[6]||(o[6]=e=>r.value=e)},{default:b(()=>[x(c(B),{label:t.$t("rejecting.title")},{default:b(()=>[x(c(I),{modelValue:c(a).values.reject_reason,"onUpdate:modelValue":o[3]||(o[3]=e=>c(a).values.reject_reason=e),placeholder:t.$t("rejecting.title_text")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),x(c(B),{label:t.$t("rejecting.file")},{default:b(()=>[x(c(P),{id:"reject-file",modelValue:c(a).values.file,"onUpdate:modelValue":o[4]||(o[4]=e=>c(a).values.file=e)},null,8,["modelValue"])]),_:1},8,["label"]),n("div",ee,[x(c(F),{onClick:o[5]||(o[5]=e=>r.value=!1),text:t.$t("rejecting.cancel"),variant:"neutral",class:"flex-1"},null,8,["text"]),x(c(F),{text:t.$t("rejecting.reject"),variant:"danger",class:"flex-1"},null,8,["text"])])]),_:1},8,["title","modelValue"])]))}}),ae={key:0,class:"space-y-6"},le={class:"flex items-center justify-between p-4 bg-gray-5 rounded-lg"},se={class:"flex items-center gap-3"},re={class:"text-lg font-semibold text-dark"},oe={class:"text-sm text-gray-1"},ue={class:"text-right"},ie={class:"text-xs text-gray-1 mt-1"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},de={class:"space-y-4"},pe={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},ce={class:"space-y-3"},me={class:"flex justify-between items-center"},ve={class:"text-sm text-gray-1"},_e={class:"text-sm text-dark"},xe={class:"flex justify-between items-center"},ge={class:"text-sm text-gray-1"},fe={class:"text-sm text-dark"},ye={class:"flex justify-between items-center"},be={class:"text-sm text-gray-1"},he={class:"text-sm text-dark"},je={class:"space-y-4"},ke={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},we={class:"space-y-3"},$e={class:"flex justify-between items-center"},Ve={class:"text-sm text-gray-1"},De={class:"flex gap-2"},Ce={key:0,class:"space-y-4"},Ue={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},Ae={class:"p-4 bg-gray-5 rounded-lg"},ze={class:"text-sm text-dark"},Fe={class:"space-y-4"},Se={class:"text-md font-semibold text-dark border-b border-gray-4 pb-2"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Re={class:"flex justify-between items-center"},Ie={class:"text-sm text-gray-1"},Le={class:"text-sm text-dark"},Te={class:"flex justify-between items-center"},qe={class:"text-sm text-gray-1"},Oe={class:"text-sm text-dark"},Me={key:1,class:"flex items-center justify-center py-8"},Ee={class:"flex justify-end gap-3"},Ge=k(a({__name:"AppealDetailsModal",props:{modelValue:{type:Boolean},appealUid:{}},emits:["update:modelValue","appeal-updated"],setup(e,{emit:t}){const a=e,l=t,{t:r}=s(),{showToast:d}=_(),m=h({get:()=>a.modelValue,set:e=>l("update:modelValue",e)}),y=o(null),k=()=>{m.value=!1,y.value=null},w=()=>{d("success",r("appeals.approved_successfully")),y.value&&(y.value.status="accepted",l("appeal-updated",y.value))},$=()=>{d("success",r("appeals.rejected_successfully")),y.value&&(y.value.status="rejected",l("appeal-updated",y.value))},V=e=>{switch(e){case"in_review":return"bg-yellow/10 text-yellow";case"accepted":return"bg-green/10 text-green";case"rejected":return"bg-red/10 text-red";default:return"bg-gray-4 text-gray-8"}};return j(()=>a.modelValue,e=>{e&&a.appealUid}),(e,t)=>(i(),g(c(L),{title:e.$t("appeals.details"),modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=e=>m.value=e),onClose:k,class:"max-w-2xl"},{footer:b(()=>[n("div",Ee,[x(c(F),{text:e.$t("button.close"),variant:"outline",onClick:k},null,8,["text"])])]),default:b(()=>[y.value?(i(),u("div",ae,[n("div",le,[n("div",se,[t[1]||(t[1]=n("div",{class:"w-12 h-12 bg-primary rounded-lg flex items-center justify-center"},[n("i",{class:"icon-document text-white text-xl"})],-1)),n("div",null,[n("h3",re,"Appeal #"+v(y.value.id),1),n("p",oe,v(y.value.uid),1)])]),n("div",ue,[n("span",{class:p([V(y.value.status),"px-3 py-1 rounded-full text-xs font-medium"])},v(e.$t(`appeals.status.${y.value.status}`)),3),n("p",ie,"UID: "+v(y.value.uid),1)])]),n("div",ne,[n("div",de,[n("h4",pe,v(e.$t("appeals.basic_info")),1),n("div",ce,[n("div",me,[n("span",ve,v(e.$t("appeals.text"))+":",1),n("span",_e,v(y.value.text),1)]),n("div",xe,[n("span",ge,v(e.$t("appeals.file"))+":",1),n("span",fe,v(y.value.file?e.$t("appeals.file_attached"):e.$t("appeals.no_file")),1)]),n("div",ye,[n("span",be,v(e.$t("appeals.action_time"))+":",1),n("span",he,v(y.value.action_time?c(q)(y.value.action_time):e.$t("appeals.no_action_time")),1)])])]),n("div",je,[n("h4",ke,v(e.$t("appeals.status_actions")),1),n("div",we,[n("div",$e,[n("span",Ve,v(e.$t("appeals.status"))+":",1),n("span",{class:p([V(y.value.status),"px-2 py-1 rounded text-xs font-medium"])},v(e.$t(`appeals.status.${y.value.status}`)),3)]),n("div",De,[x(c(F),{text:e.$t("approve"),variant:"success",size:"sm",onClick:w,disabled:"in_review"!==y.value.status},null,8,["text","disabled"]),x(c(F),{text:e.$t("reject"),variant:"danger",size:"sm",onClick:$,disabled:"in_review"!==y.value.status},null,8,["text","disabled"])])])])]),y.value.payment_instrument_json?(i(),u("div",Ce,[n("h4",Ue,v(e.$t("appeals.payment_instrument")),1),n("div",Ae,[n("pre",ze,v(JSON.stringify(y.value.payment_instrument_json,null,2)),1)])])):f("",!0),n("div",Fe,[n("h4",Se,v(e.$t("appeals.timestamps")),1),n("div",Be,[n("div",Re,[n("span",Ie,v(e.$t("appeals.created_at"))+":",1),n("span",Le,v(c(q)(y.value.created_at)),1)]),n("div",Te,[n("span",qe,v(e.$t("appeals.updated_at"))+":",1),n("span",Oe,v(c(q)(y.value.updated_at)),1)])])])])):(i(),u("div",Me,[...t[2]||(t[2]=[n("div",{class:"loader"},null,-1)])]))]),_:1},8,["title","modelValue"]))}}),[["__scopeId","data-v-9ec1aed9"]]),He={class:"bg-white px-6 rounded-xl"},Je={class:"flex items-center gap-1"},Ne={class:"text-sm font-medium text-dark-black"},Pe={class:"flex gap-5"},We=k(a({__name:"PAppeals",setup(a){const{t:l}=s(),r=e("status",l("statuses.all_statuses")),{tableData:d,pagination:p,isLoading:_,refetch:g}=T("/explat/appeals/",(()=>{const e={};return r.value&&r.value!==l("statuses.all_statuses")&&(e.status=r.value),e})(),["tab"]),f=o(!1),y=o("");function h(e){y.value=e.uid,f.value=!0}function j(e){console.log("Appeal updated:",e),g()}return(e,a)=>{var l,s;return i(),u("section",null,[n("div",He,[x(c(U),w({data:c(d),head:c(W)(),loading:c(_),title:e.$t("appeals.title"),subtitle:e.$t("appeals.count",{count:(null==(l=c(p))?void 0:l.count)||0}),total:(null==(s=c(p))?void 0:s.count)||0,filter:{status:c(r)}},c(K)(),{onClickToRow:h}),{id:b(({data:e})=>[n("div",Je,[n("span",Ne,[m(v(null==e?void 0:e.id)+" ",1),a[1]||(a[1]=n("i",{class:"icon-copy text-primary font-semibold"},null,-1))])])]),amount:b(({data:e})=>[x(c($),{amount:0,currency:"₽"})]),device:b(({data:e})=>[x(c(V),{title:"Appeal",id:null==e?void 0:e.id},null,8,["id"])]),payment_method:b(({data:e})=>[x(c(D),{number:null==e?void 0:e.uid,name:"Appeal",bank:"System",payment_method:null==e?void 0:e.status},null,8,["number","payment_method"])]),actions:b(({data:t})=>[x(te,{approve:e.$t("approve"),reject:e.$t("reject"),onApprove:e=>{console.log("asd")},onReject:e=>(e=>{console.log(e)})(t)},null,8,["approve","reject","onApprove","onReject"])]),date:b(({data:e})=>[x(z,{date:null==e?void 0:e.created_at,time:null==e?void 0:e.created_at},null,8,["date","time"])]),filter:b(()=>[n("div",Pe,[x(A,{label:e.$t("interval_of_time")},{default:b(()=>[x(t,{class:"bg-white","start-date-key":"created_at__gte","end-date-key":"created_at__lte"})]),_:1},8,["label"])])]),_:1},16,["data","head","loading","title","subtitle","total","filter"])]),x(Ge,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),"appeal-uid":y.value,onAppealUpdated:j},null,8,["modelValue","appeal-uid"])])}}}),[["__scopeId","data-v-d3629569"]]);export{We as default};
